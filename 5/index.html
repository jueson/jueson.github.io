<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TVbox编辑器</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-bg: #f8f9fa;
            --dark-bg: #2c3e50;
            --border-color: #dee2e6;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            padding: 8px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 6px;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 10px 15px;
            text-align: center;
        }
        
        h1 {
            font-size: 1.4rem;
            margin-bottom: 4px;
        }
        
        .subtitle {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            min-height: 680px;
        }
        
        .sidebar {
            width: 180px;
            background: var(--dark-bg);
            color: white;
            padding: 12px 0;
        }
        
        .module-list {
            list-style: none;
        }
        
        .module-item {
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            font-size: 0.85rem;
        }
        
        .module-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .module-item.active {
            background: rgba(255, 255, 255, 0.15);
            border-left: 3px solid var(--primary-color);
        }
        
        .editor-area {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            max-height: 680px;
        }
        
        .editor-section {
            margin-bottom: 18px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .section-title {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 6px;
        }
        
        .form-group {
            margin-bottom: 10px;
        }
        
        label {
            display: block;
            margin-bottom: 3px;
            font-weight: 500;
            font-size: 0.85rem;
        }
        
        input[type="text"], textarea {
            width: 100%;
            padding: 7px 9px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            font-size: 0.85rem;
        }
        
        textarea {
            min-height: 70px;
            resize: vertical;
            font-family: monospace;
        }
        
        .btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .btn-group {
            display: flex;
            gap: 7px;
            margin-top: 7px;
        }
        
        .group-container {
            border: 1px solid var(--border-color);
            border-radius: 3px;
            padding: 10px;
            margin-bottom: 10px;
            position: relative;
        }
        
        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 7px;
        }
        
        .group-title {
            font-weight: bold;
            color: var(--secondary-color);
            font-size: 0.85rem;
        }
        
        .group-actions {
            display: flex;
            align-items: center;
            gap: 7px;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .add-group-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            margin: 0 0 8px 0;
            font-size: 0.8rem;
        }
        
        .add-group-btn i {
            margin-right: 4px;
        }
        
        .footer {
            padding: 12px;
            text-align: center;
            background: var(--light-bg);
            border-top: 1px solid var(--border-color);
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        
        .action-btn {
            padding: 8px 16px;
            font-size: 0.85rem;
        }
        
        .notification {
            position: fixed;
            top: 12px;
            right: 12px;
            padding: 10px 16px;
            border-radius: 3px;
            background: var(--success-color);
            color: white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12);
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: var(--danger-color);
        }
        
        .hidden {
            display: none;
        }
        
        .input-methods {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .input-method-row {
            display: flex;
            gap: 8px;
        }
        
        .input-method {
            flex: 1;
            padding: 8px;
            border: 2px dashed var(--border-color);
            border-radius: 3px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .input-method:hover {
            border-color: var(--primary-color);
            background: rgba(52, 152, 219, 0.05);
        }
        
        .input-method i {
            font-size: 1.1rem;
            margin-bottom: 4px;
            color: var(--primary-color);
        }
        
        .paste-container {
            position: relative;
            flex: 2;
        }
        
        .reload-btn {
            position: absolute;
            right: 5px;
            top: 5px;
            padding: 3px 6px;
            font-size: 0.75rem;
        }
        
        .two-column-input {
            display: flex;
            gap: 7px;
        }
        
        .two-column-input .form-group {
            flex: 1;
        }
        
        .compact-input {
            font-size: 0.75rem;
            min-height: 45px;
        }
        
        .full-json-input {
            min-height: 90px;
            font-size: 0.75rem;
        }
        
        .output-area {
            margin-top: 12px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            padding: 10px;
        }
        
        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 7px;
        }
        
        .output-title {
            font-weight: bold;
            color: var(--secondary-color);
            font-size: 0.85rem;
        }
        
        .output-content {
            background: #f8f9fa;
            border-radius: 3px;
            padding: 7px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 220px;
            overflow-y: auto;
            font-size: 0.75rem;
        }
        
        .batch-actions {
            display: flex;
            gap: 7px;
            margin-top: 10px;
            margin-bottom: 8px;
        }
        
        .batch-btn {
            padding: 4px 8px;
            font-size: 0.75rem;
        }
        
        .left-align {
            text-align: left;
        }
        
        .text-left {
            text-align: left;
        }
        
        .text-left textarea {
            text-align: left;
        }
        
        .module-actions {
            margin-top: 10px;
        }
        
        .local-storage-check {
            padding: 5px;
            margin-bottom: 10px;
            border-radius: 3px;
            font-size: 0.75rem;
            text-align: center;
        }
        
        .local-storage-check.success {
            background-color: rgba(46, 204, 113, 0.1);
            color: #27ae60;
            border: 1px solid #2ecc71;
        }
        
        .local-storage-check.error {
            background-color: rgba(231, 76, 60, 0.1);
            color: #c0392b;
            border: 1px solid #e74c3c;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 8px 0;
            }
            
            .module-item {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .input-method-row {
                flex-direction: column;
            }
            
            .two-column-input {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .action-btn {
                width: 100%;
                max-width: 280px;
            }
            
            .batch-actions {
                flex-direction: column;
            }
            
            .batch-btn {
                width: 100%;
            }
            
            .group-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .container {
                border-radius: 4px;
            }
            
            header {
                padding: 8px 10px;
            }
            
            h1 {
                font-size: 1.2rem;
            }
            
            .editor-area {
                padding: 8px;
            }
            
            .action-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            .output-content {
                max-height: 180px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-tv"></i> TVbox JSON编辑器</h1>
            <p class="subtitle">可视化编辑TVbox配置文件，支持导入导出、格式化和加密</p>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <ul class="module-list">
                    <li class="module-item active" data-module="general"><i class="fas fa-cog"></i> 通用设置</li>
                    <li class="module-item" data-module="sites"><i class="fas fa-film"></i> 点播模块</li>
                    <li class="module-item" data-module="lives"><i class="fas fa-satellite"></i> 直播模块</li>
                    <li class="module-item" data-module="parses"><i class="fas fa-code"></i> 解析模块</li>
                    <li class="module-item" data-module="others"><i class="fas fa-sliders-h"></i> 其他设置</li>
                    <li class="module-item" data-module="extra"><i class="fas fa-plus-circle"></i> 其他模块</li>
                </ul>
            </div>
            
            <div class="editor-area">
                <div class="input-methods">
                    <div class="input-method-row">
                        <div class="input-method paste-container left-align" id="paste-method">
                            <i class="fas fa-paste"></i>
                            <p>粘贴JSON内容</p>
                            <textarea id="json-paste" placeholder="在此处粘贴JSON内容..." style="height: 100px; text-align: left;"></textarea>
                            <button class="btn btn-primary reload-btn" id="reload-json">
                                <i class="fas fa-redo"></i> 重新加载
                            </button>
                        </div>
                    </div>
                    <div class="input-method-row">
                        <div class="input-method" id="file-method">
                            <i class="fas fa-file-upload"></i>
                            <p>上传JSON文件</p>
                            <input type="file" id="file-input" accept=".json" style="margin-top: 4px;">
                        </div>
                        <div class="input-method" id="url-method">
                            <i class="fas fa-link"></i>
                            <p>从URL加载</p>
                            <input type="text" id="url-input" placeholder="输入JSON文件URL" style="margin: 4px 0;">
                            <button class="btn btn-primary" id="load-url" style="width: 100%;">加载</button>
                        </div>
                    </div>
                </div>
                
                <div id="local-storage-status" class="local-storage-check success">
                    <i class="fas fa-check-circle"></i> 浏览器缓存功能已启用
                </div>
                
                <div id="general-editor" class="editor-section">
                    <h2 class="section-title"><i class="fas fa-cog"></i> 通用设置</h2>
                    
                    <div class="form-group">
                        <label for="spider">Spider URL</label>
                        <input type="text" id="spider" placeholder="https://example.com/catvod.jar;md5;hash">
                    </div>
                    
                    <div class="form-group">
                        <label for="wallpaper">壁纸URL</label>
                        <input type="text" id="wallpaper" placeholder="http://example.com/wallpaper.php">
                    </div>
                    
                    <div class="form-group">
                        <label for="logo">Logo URL</label>
                        <input type="text" id="logo" placeholder="https://example.com/logo.jpg">
                    </div>
                    
                    <div class="form-group">
                        <label for="warningText">警告文本</label>
                        <input type="text" id="warningText" placeholder="自定义警告文本">
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-warning" id="lock-general">
                            <i class="fas fa-lock"></i> 锁定设置
                        </button>
                    </div>
                </div>
                
                <div id="sites-editor" class="editor-section hidden">
                    <h2 class="section-title"><i class="fas fa-film"></i> 点播模块 (sites)</h2>
                    
                    <button class="add-group-btn" id="add-site-group">
                        <i class="fas fa-plus"></i> 添加站点组
                    </button>
                    
                    <div id="sites-container">
                        <!-- 站点组将通过JS动态添加 -->
                    </div>
                    
                    <div class="module-actions">
                        <div class="batch-actions">
                            <button class="btn btn-danger batch-btn" id="batch-delete-sites">
                                <i class="fas fa-trash"></i> 批量删除
                            </button>
                            <button class="btn btn-warning batch-btn" id="batch-lock-sites">
                                <i class="fas fa-lock"></i> 批量锁定
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="lives-editor" class="editor-section hidden">
                    <h2 class="section-title"><i class="fas fa-satellite"></i> 直播模块 (lives)</h2>
                    
                    <button class="add-group-btn" id="add-live-group">
                        <i class="fas fa-plus"></i> 添加直播源
                    </button>
                    
                    <div id="lives-container">
                        <!-- 直播组将通过JS动态添加 -->
                    </div>
                    
                    <div class="module-actions">
                        <div class="batch-actions">
                            <button class="btn btn-danger batch-btn" id="batch-delete-lives">
                                <i class="fas fa-trash"></i> 批量删除
                            </button>
                            <button class="btn btn-warning batch-btn" id="batch-lock-lives">
                                <i class="fas fa-lock"></i> 批量锁定
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="parses-editor" class="editor-section hidden">
                    <h2 class="section-title"><i class="fas fa-code"></i> 解析模块 (parses)</h2>
                    
                    <button class="add-group-btn" id="add-parse-group">
                        <i class="fas fa-plus"></i> 添加解析源
                    </button>
                    
                    <div id="parses-container">
                        <!-- 解析组将通过JS动态添加 -->
                    </div>
                    
                    <div class="module-actions">
                        <div class="batch-actions">
                            <button class="btn btn-danger batch-btn" id="batch-delete-parses">
                                <i class="fas fa-trash"></i> 批量删除
                            </button>
                            <button class="btn btn-warning batch-btn" id="batch-lock-parses">
                                <i class="fas fa-lock"></i> 批量锁定
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="others-editor" class="editor-section hidden">
                    <h2 class="section-title"><i class="fas fa-sliders-h"></i> 其他设置</h2>
                    
                    <div class="form-group">
                        <label for="hosts">Hosts</label>
                        <textarea id="hosts" placeholder="每行一个host映射" style="height: 70px;"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="doh">DOH设置</label>
                        <textarea id="doh" placeholder="DNS over HTTPS配置" style="height: 90px;"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="flags">Flags</label>
                        <textarea id="flags" placeholder="每行一个flag" style="height: 70px;"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="rules">规则 (rules)</label>
                        <textarea id="rules" placeholder="规则配置" style="height: 90px;"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="ijk">IJK播放器设置</label>
                        <textarea id="ijk" placeholder="IJK播放器配置" style="height: 90px;"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="proxy">代理设置</label>
                        <textarea id="proxy" placeholder="代理配置" style="height: 70px;"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="ads">广告过滤</label>
                        <textarea id="ads" placeholder="广告域名列表" style="height: 70px;"></textarea>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-warning" id="lock-others">
                            <i class="fas fa-lock"></i> 锁定设置
                        </button>
                    </div>
                </div>
                
                <div id="extra-editor" class="editor-section hidden">
                    <h2 class="section-title"><i class="fas fa-plus-circle"></i> 其他模块</h2>
                    
                    <div class="form-group">
                        <label for="extra-json">其他/自定义JSON配置</label>
                        <textarea id="extra-json" placeholder='在此处添加其他自定义的JSON配置' style="height: 250px; text-align: left;"></textarea>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-warning" id="lock-extra">
                            <i class="fas fa-lock"></i> 锁定设置
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <div class="action-buttons">
                <button class="btn btn-primary action-btn" id="format-json">
                    <i class="fas fa-indent"></i> 格式化JSON
                </button>
                <button class="btn btn-success action-btn" id="export-json">
                    <i class="fas fa-download"></i> 导出JSON
                </button>
                <button class="btn btn-warning action-btn" id="copy-json">
                    <i class="fas fa-copy"></i> 复制到剪贴板
                </button>
                <button class="btn btn-danger action-btn" id="encrypt-json">
                    <i class="fas fa-lock"></i> 简单加密
                </button>
                <button class="btn btn-danger action-btn" id="clear-all">
                    <i class="fas fa-trash"></i> 清空所有
                </button>
            </div>
            
            <div class="output-area left-align">
                <div class="output-header">
                    <div class="output-title">输出结果</div>
                    <button class="btn btn-primary" id="copy-output">
                        <i class="fas fa-copy"></i> 复制输出
                    </button>
                </div>
                <div class="output-content text-left" id="output-content">
                    格式化或加密后的内容将显示在这里...
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        操作成功！
    </div>
    
    <script>
        // 示例JSON数据（已清空预设值）
        const sampleJson = {
            "spider": "",
            "wallpaper": "",
            "logo": "",
            "warningText": "",
            "sites": [],
            "lives": [],
            "parses": [],
            "hosts": [],
            "doh": [],
            "flags": [],
            "rules": [],
            "ijk": [],
            "proxy": [],
            "ads": []
        };

        // DOM元素
        const moduleItems = document.querySelectorAll('.module-item');
        const editorSections = document.querySelectorAll('.editor-section');
        const notification = document.getElementById('notification');
        const outputContent = document.getElementById('output-content');
        const localStorageStatus = document.getElementById('local-storage-status');
        
        // 检查localStorage是否可用
        function isLocalStorageAvailable() {
            try {
                const testKey = '__test__';
                localStorage.setItem(testKey, testKey);
                localStorage.removeItem(testKey);
                return true;
            } catch (e) {
                return false;
            }
        }
        
        // 更新localStorage状态显示
        function updateLocalStorageStatus() {
            if (isLocalStorageAvailable()) {
                localStorageStatus.innerHTML = '<i class="fas fa-check-circle"></i> 浏览器缓存功能已启用';
                localStorageStatus.className = 'local-storage-check success';
            } else {
                localStorageStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i> 浏览器缓存功能不可用，数据不会自动保存';
                localStorageStatus.className = 'local-storage-check error';
            }
        }
        
        // 安全地保存到localStorage
        function saveToLocalStorage(key, data) {
            if (!isLocalStorageAvailable()) {
                console.warn('localStorage不可用，数据未保存');
                return false;
            }
            
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (e) {
                console.error('保存到localStorage失败:', e);
                localStorageStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i> 浏览器缓存功能异常，数据可能未保存';
                localStorageStatus.className = 'local-storage-check error';
                return false;
            }
        }
        
        // 从localStorage安全读取
        function getFromLocalStorage(key) {
            if (!isLocalStorageAvailable()) {
                return null;
            }
            
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                console.error('从localStorage读取失败:', e);
                return null;
            }
        }
        
        // 从localStorage删除
        function removeFromLocalStorage(key) {
            if (!isLocalStorageAvailable()) {
                return;
            }
            
            try {
                localStorage.removeItem(key);
            } catch (e) {
                console.error('从localStorage删除失败:', e);
            }
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 更新localStorage状态
            updateLocalStorageStatus();
            
            // 加载缓存数据
            loadFromCache();
            
            // 设置模块切换
            moduleItems.forEach(item => {
                item.addEventListener('click', () => {
                    // 更新活动模块
                    moduleItems.forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    
                    // 显示对应编辑器
                    const moduleId = item.dataset.module;
                    editorSections.forEach(section => {
                        section.classList.add('hidden');
                    });
                    document.getElementById(`${moduleId}-editor`).classList.remove('hidden');
                });
            });
            
            // 设置输入方法
            setupInputMethods();
            
            // 设置按钮事件
            setupButtonEvents();
            
            // 初始化站点编辑器
            initSitesEditor();
            initLivesEditor();
            initParsesEditor();
        });
        
        // 设置输入方法
        function setupInputMethods() {
            // 粘贴方法
            const jsonPaste = document.getElementById('json-paste');
            jsonPaste.addEventListener('input', function() {
                if (this.value.trim()) {
                    try {
                        const jsonData = JSON.parse(this.value);
                        loadJsonData(jsonData);
                        showNotification('JSON加载成功！');
                    } catch (e) {
                        showNotification('JSON格式错误: ' + e.message, true);
                    }
                }
            });
            
            // 文件上传
            const fileInput = document.getElementById('file-input');
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const jsonData = JSON.parse(event.target.result);
                            // 将内容显示到粘贴输入框
                            jsonPaste.value = JSON.stringify(jsonData, null, 2);
                            loadJsonData(jsonData);
                            showNotification('文件加载成功！');
                        } catch (e) {
                            showNotification('JSON解析错误: ' + e.message, true);
                        }
                    };
                    reader.readAsText(file);
                }
            });
            
            // URL加载
            const loadUrlBtn = document.getElementById('load-url');
            loadUrlBtn.addEventListener('click', function() {
                const urlInput = document.getElementById('url-input');
                const url = urlInput.value.trim();
                if (url) {
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            // 将内容显示到粘贴输入框
                            jsonPaste.value = JSON.stringify(data, null, 2);
                            loadJsonData(data);
                            showNotification('URL加载成功！');
                        })
                        .catch(error => {
                            showNotification('加载失败: ' + error.message, true);
                        });
                } else {
                    showNotification('请输入有效的URL', true);
                }
            });
            
            // 重新加载按钮 - 修改为加载粘贴输入框的内容
            document.getElementById('reload-json').addEventListener('click', function() {
                const pasteContent = jsonPaste.value;
                if (pasteContent.trim()) {
                    try {
                        const jsonData = JSON.parse(pasteContent);
                        loadJsonData(jsonData);
                        showNotification('已从粘贴框重新加载！');
                    } catch (e) {
                        showNotification('JSON解析错误: ' + e.message, true);
                    }
                } else {
                    showNotification('粘贴框没有内容', true);
                }
            });
        }
        
        // 设置按钮事件
        function setupButtonEvents() {
            // 格式化JSON
            document.getElementById('format-json').addEventListener('click', formatJson);
            
            // 导出JSON
            document.getElementById('export-json').addEventListener('click', exportJson);
            
            // 复制JSON
            document.getElementById('copy-json').addEventListener('click', copyJsonToClipboard);
            
            // 加密JSON
            document.getElementById('encrypt-json').addEventListener('click', encryptJson);
            
            // 清空所有
            document.getElementById('clear-all').addEventListener('click', clearAll);
            
            // 复制输出
            document.getElementById('copy-output').addEventListener('click', copyOutput);
            
            // 锁定通用设置
            document.getElementById('lock-general').addEventListener('click', lockGeneralSettings);
            
            // 批量删除站点
            document.getElementById('batch-delete-sites').addEventListener('click', batchDeleteSites);
            
            // 批量锁定站点
            document.getElementById('batch-lock-sites').addEventListener('click', batchLockSites);
            
            // 批量删除直播
            document.getElementById('batch-delete-lives').addEventListener('click', batchDeleteLives);
            
            // 批量锁定直播
            document.getElementById('batch-lock-lives').addEventListener('click', batchLockLives);
            
            // 批量删除解析
            document.getElementById('batch-delete-parses').addEventListener('click', batchDeleteParses);
            
            // 批量锁定解析
            document.getElementById('batch-lock-parses').addEventListener('click', batchLockParses);
            
            // 锁定其他设置
            document.getElementById('lock-others').addEventListener('click', lockOthersSettings);
            
            // 锁定其他模块
            document.getElementById('lock-extra').addEventListener('click', lockExtraSettings);
            
            // 添加站点组
            document.getElementById('add-site-group').addEventListener('click', addSiteGroup);
            
            // 添加直播源
            document.getElementById('add-live-group').addEventListener('click', addLiveGroup);
            
            // 添加解析源
            document.getElementById('add-parse-group').addEventListener('click', addParseGroup);
        }
        
        // 加载JSON数据到编辑器
        function loadJsonData(data) {
            // 保存到缓存
            saveToLocalStorage('tvbox_json', data);
            
            // 填充通用设置
            document.getElementById('spider').value = data.spider || '';
            document.getElementById('wallpaper').value = data.wallpaper || '';
            document.getElementById('logo').value = data.logo || '';
            document.getElementById('warningText').value = data.warningText || '';
            
            // 填充站点
            populateSites(data.sites || []);
            
            // 填充直播
            populateLives(data.lives || []);
            
            // 填充解析
            populateParses(data.parses || []);
            
            // 填充其他设置
            document.getElementById('hosts').value = Array.isArray(data.hosts) ? data.hosts.join('\n') : '';
            document.getElementById('doh').value = JSON.stringify(data.doh || [], null, 2);
            document.getElementById('flags').value = Array.isArray(data.flags) ? data.flags.join('\n') : '';
            document.getElementById('rules').value = JSON.stringify(data.rules || [], null, 2);
            document.getElementById('ijk').value = JSON.stringify(data.ijk || [], null, 2);
            document.getElementById('proxy').value = Array.isArray(data.proxy) ? data.proxy.join('\n') : '';
            document.getElementById('ads').value = Array.isArray(data.ads) ? data.ads.join('\n') : '';
            
            // 填充其他模块
            if (data.extra) {
                document.getElementById('extra-json').value = JSON.stringify(data.extra, null, 2);
            } else {
                document.getElementById('extra-json').value = '';
            }
            
            showNotification('数据加载成功！');
        }
        
        // 从缓存加载数据
        function loadFromCache() {
            const cachedData = getFromLocalStorage('tvbox_json');
            if (cachedData) {
                try {
                    loadJsonData(cachedData);
                } catch (e) {
                    console.error('缓存数据解析错误:', e);
                    // 加载示例数据
                    loadJsonData(sampleJson);
                }
            } else {
                // 加载示例数据
                loadJsonData(sampleJson);
            }
        }
        
        // 初始化站点编辑器
        function initSitesEditor() {
            document.getElementById('sites-container').innerHTML = '';
            // 初始添加一个空组
            addSiteGroup();
        }
        
        // 添加站点组
        function addSiteGroup() {
            const container = document.getElementById('sites-container');
            const groupId = `site-${Date.now()}`;
            
            const groupHtml = `
                <div class="group-container" id="${groupId}">
                    <div class="group-header">
                        <div class="group-title">站点组 ${container.children.length + 1}</div>
                        <div class="group-actions">
                            <div class="checkbox-container">
                                <input type="checkbox" class="group-checkbox" id="checkbox-${groupId}">
                                <label for="checkbox-${groupId}">选择</label>
                            </div>
                        </div>
                    </div>
                    <div class="two-column-input">
                        <div class="form-group">
                            <label>Key</label>
                            <input type="text" class="site-key" placeholder="唯一标识符" oninput="autoSaveModule('sites')">
                        </div>
                        <div class="form-group">
                            <label>名称</label>
                            <input type="text" class="site-name" placeholder="显示名称" oninput="autoSaveModule('sites')">
                        </div>
                    </div>
                    <div class="two-column-input">
                        <div class="form-group">
                            <label>类型 (type)</label>
                            <input type="number" class="site-type" value="3" oninput="autoSaveModule('sites')">
                        </div>
                        <div class="form-group">
                            <label>API</label>
                            <input type="text" class="site-api" placeholder="API名称" oninput="autoSaveModule('sites')">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>其他设置</label>
                        <textarea class="site-extras compact-input" placeholder='"indexs": 1, "searchable": 0' oninput="autoSaveModule('sites')"></textarea>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', groupHtml);
        }
        
        // 填充站点数据
        function populateSites(sites) {
            const container = document.getElementById('sites-container');
            container.innerHTML = '';
            
            sites.forEach((site, index) => {
                const groupId = `site-${Date.now()}-${index}`;
                
                // 提取额外设置
                const { key, name, type, api, ...extras } = site;
                
                // 构建额外设置字符串
                let extrasStr = '';
                const extrasEntries = Object.entries(extras);
                extrasEntries.forEach(([k, v], idx) => {
                    if (typeof v === 'object') {
                        extrasStr += `"${k}": ${JSON.stringify(v)}`;
                    } else {
                        extrasStr += `"${k}": ${JSON.stringify(v)}`;
                    }
                    if (idx < extrasEntries.length - 1) {
                        extrasStr += ', ';
                    }
                });
                
                const groupHtml = `
                    <div class="group-container" id="${groupId}">
                        <div class="group-header">
                            <div class="group-title">${site.name || '站点组'}</div>
                            <div class="group-actions">
                                <div class="checkbox-container">
                                    <input type="checkbox" class="group-checkbox" id="checkbox-${groupId}">
                                    <label for="checkbox-${groupId}">选择</label>
                                </div>
                            </div>
                        </div>
                        <div class="two-column-input">
                            <div class="form-group">
                                <label>Key</label>
                                <input type="text" class="site-key" value="${site.key || ''}" placeholder="唯一标识符" oninput="autoSaveModule('sites')">
                            </div>
                            <div class="form-group">
                                <label>名称</label>
                                <input type="text" class="site-name" value="${site.name || ''}" placeholder="显示名称" oninput="autoSaveModule('sites')">
                            </div>
                        </div>
                        <div class="two-column-input">
                            <div class="form-group">
                                <label>类型 (type)</label>
                                <input type="number" class="site-type" value="${site.type || 3}" oninput="autoSaveModule('sites')">
                            </div>
                            <div class="form-group">
                                <label>API</label>
                                <input type="text" class="site-api" value="${site.api || ''}" placeholder="API名称" oninput="autoSaveModule('sites')">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>其他设置</label>
                            <textarea class="site-extras compact-input" placeholder='"key": "value"' oninput="autoSaveModule('sites')">${extrasStr}</textarea>
                        </div>
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', groupHtml);
            });
        }
        
        // 初始化直播编辑器
        function initLivesEditor() {
            document.getElementById('lives-container').innerHTML = '';
            // 初始添加一个空组
            addLiveGroup();
        }
        
        // 添加直播源
        function addLiveGroup() {
            const container = document.getElementById('lives-container');
            const groupId = `live-${Date.now()}`;
            
            const groupHtml = `
                <div class="group-container" id="${groupId}">
                    <div class="group-header">
                        <div class="group-title">直播源 ${container.children.length + 1}</div>
                        <div class="group-actions">
                            <div class="checkbox-container">
                                <input type="checkbox" class="group-checkbox" id="checkbox-${groupId}">
                                <label for="checkbox-${groupId}">选择</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>名称</label>
                        <input type="text" class="live-name" placeholder="直播源名称" oninput="autoSaveModule('lives')">
                    </div>
                    <div class="form-group">
                        <label>URL</label>
                        <input type="text" class="live-url" placeholder="直播源URL" oninput="autoSaveModule('lives')">
                    </div>
                    <div class="form-group">
                        <label>其他设置</label>
                        <textarea class="live-extras compact-input" placeholder='"type": 0' oninput="autoSaveModule('lives')"></textarea>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', groupHtml);
        }
        
        // 填充直播数据
        function populateLives(lives) {
            const container = document.getElementById('lives-container');
            container.innerHTML = '';
            
            lives.forEach((live, index) => {
                const groupId = `live-${Date.now()}-${index}`;
                
                // 提取额外设置
                const { name, url, ...extras } = live;
                
                // 构建额外设置字符串
                let extrasStr = '';
                const extrasEntries = Object.entries(extras);
                extrasEntries.forEach(([k, v], idx) => {
                    extrasStr += `"${k}": ${JSON.stringify(v)}`;
                    if (idx < extrasEntries.length - 1) {
                        extrasStr += ', ';
                    }
                });
                
                const groupHtml = `
                    <div class="group-container" id="${groupId}">
                        <div class="group-header">
                            <div class="group-title">${live.name || '直播源'}</div>
                            <div class="group-actions">
                                <div class="checkbox-container">
                                    <input type="checkbox" class="group-checkbox" id="checkbox-${groupId}">
                                    <label for="checkbox-${groupId}">选择</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>名称</label>
                            <input type="text" class="live-name" value="${live.name || ''}" placeholder="直播源名称" oninput="autoSaveModule('lives')">
                        </div>
                        <div class="form-group">
                            <label>URL</label>
                            <input type="text" class="live-url" value="${live.url || ''}" placeholder="直播源URL" oninput="autoSaveModule('lives')">
                        </div>
                        <div class="form-group">
                            <label>其他设置</label>
                            <textarea class="live-extras compact-input" placeholder='"type": 0' oninput="autoSaveModule('lives')">${extrasStr}</textarea>
                        </div>
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', groupHtml);
            });
        }
        
        // 初始化解析编辑器
        function initParsesEditor() {
            document.getElementById('parses-container').innerHTML = '';
            // 初始添加一个空组
            addParseGroup();
        }
        
        // 添加解析源
        function addParseGroup() {
            const container = document.getElementById('parses-container');
            const groupId = `parse-${Date.now()}`;
            
            const groupHtml = `
                <div class="group-container" id="${groupId}">
                    <div class="group-header">
                        <div class="group-title">解析源 ${container.children.length + 1}</div>
                        <div class="group-actions">
                            <div class="checkbox-container">
                                <input type="checkbox" class="group-checkbox" id="checkbox-${groupId}">
                                <label for="checkbox-${groupId}">选择</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>完整配置</label>
                        <textarea class="parse-full full-json-input" placeholder='{"name": "VIP1", "type": 0, "url": "https://jx.xmflv.com/?url="}' oninput="autoSaveModule('parses')"></textarea>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', groupHtml);
        }
        
        // 填充解析数据
        function populateParses(parses) {
            const container = document.getElementById('parses-container');
            container.innerHTML = '';
            
            parses.forEach((parse, index) => {
                const groupId = `parse-${Date.now()}-${index}`;
                
                const groupHtml = `
                    <div class="group-container" id="${groupId}">
                        <div class="group-header">
                            <div class="group-title">${parse.name || '解析源'}</div>
                            <div class="group-actions">
                                <div class="checkbox-container">
                                    <input type="checkbox" class="group-checkbox" id="checkbox-${groupId}">
                                    <label for="checkbox-${groupId}">选择</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>完整配置</label>
                            <textarea class="parse-full full-json-input" placeholder='{"name": "VIP1", "type": 0, "url": "https://jx.xmflv.com/?url="}' oninput="autoSaveModule('parses')">${JSON.stringify(parse, null, 2)}</textarea>
                        </div>
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', groupHtml);
            });
        }
        
        // 自动保存模块
        function autoSaveModule(moduleName) {
            let moduleData = {};
            
            if (moduleName === 'sites') {
                const groups = document.querySelectorAll('#sites-container .group-container');
                const sites = [];
                
                groups.forEach(group => {
                    const key = group.querySelector('.site-key').value;
                    const name = group.querySelector('.site-name').value;
                    const type = parseInt(group.querySelector('.site-type').value);
                    const api = group.querySelector('.site-api').value;
                    const extrasText = group.querySelector('.site-extras').value;
                    
                    if (key && name) {
                        const site = { key, name, type, api };
                        
                        // 解析额外设置
                        if (extrasText.trim()) {
                            try {
                                // 添加最外层大括号
                                let extrasJsonStr = extrasText.trim();
                                if (!extrasJsonStr.startsWith('{')) {
                                    extrasJsonStr = '{' + extrasJsonStr;
                                }
                                if (!extrasJsonStr.endsWith('}')) {
                                    extrasJsonStr = extrasJsonStr + '}';
                                }
                                const extrasObj = JSON.parse(extrasJsonStr);
                                Object.assign(site, extrasObj);
                            } catch (e) {
                                console.warn('解析额外设置失败:', e);
                            }
                        }
                        
                        sites.push(site);
                    }
                });
                
                moduleData = sites;
            } else if (moduleName === 'lives') {
                const groups = document.querySelectorAll('#lives-container .group-container');
                const lives = [];
                
                groups.forEach(group => {
                    const name = group.querySelector('.live-name').value;
                    const url = group.querySelector('.live-url').value;
                    const extrasText = group.querySelector('.live-extras').value;
                    
                    if (name && url) {
                        const live = { name, url };
                        
                        // 解析额外设置
                        if (extrasText.trim()) {
                            try {
                                // 添加最外层大括号
                                let extrasJsonStr = extrasText.trim();
                                if (!extrasJsonStr.startsWith('{')) {
                                    extrasJsonStr = '{' + extrasJsonStr;
                                }
                                if (!extrasJsonStr.endsWith('}')) {
                                    extrasJsonStr = extrasJsonStr + '}';
                                }
                                const extrasObj = JSON.parse(extrasJsonStr);
                                Object.assign(live, extrasObj);
                            } catch (e) {
                                console.warn('解析额外设置失败:', e);
                            }
                        }
                        
                        lives.push(live);
                    }
                });
                
                moduleData = lives;
            } else if (moduleName === 'parses') {
                const groups = document.querySelectorAll('#parses-container .group-container');
                const parses = [];
                
                groups.forEach(group => {
                    const fullText = group.querySelector('.parse-full').value;
                    
                    if (fullText.trim()) {
                        try {
                            const parseObj = JSON.parse(fullText);
                            parses.push(parseObj);
                        } catch (e) {
                            console.warn('解析配置失败:', e);
                        }
                    }
                });
                
                moduleData = parses;
            }
            
            // 获取当前缓存数据
            let currentData = getFromLocalStorage('tvbox_json') || {};
            
            // 更新数据
            currentData[moduleName] = moduleData;
            
            // 保存回缓存
            saveToLocalStorage('tvbox_json', currentData);
        }
        
        // 锁定通用设置
        function lockGeneralSettings() {
            const spider = document.getElementById('spider').value;
            const wallpaper = document.getElementById('wallpaper').value;
            const logo = document.getElementById('logo').value;
            const warningText = document.getElementById('warningText').value;
            
            // 获取当前缓存数据
            let currentData = getFromLocalStorage('tvbox_json') || {};
            
            // 更新数据
            currentData.spider = spider;
            currentData.wallpaper = wallpaper;
            currentData.logo = logo;
            currentData.warningText = warningText;
            
            // 保存回缓存
            saveToLocalStorage('tvbox_json', currentData);
            
            showNotification('通用设置已锁定！');
        }
        
        // 批量删除站点
        function batchDeleteSites() {
            const checkboxes = document.querySelectorAll('#sites-container .group-checkbox:checked');
            if (checkboxes.length === 0) {
                showNotification('请先选择要删除的站点组！', true);
                return;
            }
            
            if (confirm(`确定要删除选中的 ${checkboxes.length} 个站点组吗？`)) {
                checkboxes.forEach(checkbox => {
                    const group = checkbox.closest('.group-container');
                    if (group) {
                        group.remove();
                    }
                });
                
                autoSaveModule('sites');
                showNotification(`已删除 ${checkboxes.length} 个站点组！`);
            }
        }
        
        // 批量锁定站点
        function batchLockSites() {
            autoSaveModule('sites');
            const groups = document.querySelectorAll('#sites-container .group-container');
            showNotification(`已锁定 ${groups.length} 个站点组！`);
        }
        
        // 批量删除直播
        function batchDeleteLives() {
            const checkboxes = document.querySelectorAll('#lives-container .group-checkbox:checked');
            if (checkboxes.length === 0) {
                showNotification('请先选择要删除的直播源！', true);
                return;
            }
            
            if (confirm(`确定要删除选中的 ${checkboxes.length} 个直播源吗？`)) {
                checkboxes.forEach(checkbox => {
                    const group = checkbox.closest('.group-container');
                    if (group) {
                        group.remove();
                    }
                });
                
                autoSaveModule('lives');
                showNotification(`已删除 ${checkboxes.length} 个直播源！`);
            }
        }
        
        // 批量锁定直播
        function batchLockLives() {
            autoSaveModule('lives');
            const groups = document.querySelectorAll('#lives-container .group-container');
            showNotification(`已锁定 ${groups.length} 个直播源！`);
        }
        
        // 批量删除解析
        function batchDeleteParses() {
            const checkboxes = document.querySelectorAll('#parses-container .group-checkbox:checked');
            if (checkboxes.length === 0) {
                showNotification('请先选择要删除的解析源！', true);
                return;
            }
            
            if (confirm(`确定要删除选中的 ${checkboxes.length} 个解析源吗？`)) {
                checkboxes.forEach(checkbox => {
                    const group = checkbox.closest('.group-container');
                    if (group) {
                        group.remove();
                    }
                });
                
                autoSaveModule('parses');
                showNotification(`已删除 ${checkboxes.length} 个解析源！`);
            }
        }
        
        // 批量锁定解析
        function batchLockParses() {
            autoSaveModule('parses');
            const groups = document.querySelectorAll('#parses-container .group-container');
            showNotification(`已锁定 ${groups.length} 个解析源！`);
        }
        
        // 锁定其他设置
        function lockOthersSettings() {
            const hosts = document.getElementById('hosts').value.split('\n').filter(line => line.trim());
            const doh = document.getElementById('doh').value;
            const flags = document.getElementById('flags').value.split('\n').filter(line => line.trim());
            const rules = document.getElementById('rules').value;
            const ijk = document.getElementById('ijk').value;
            const proxy = document.getElementById('proxy').value.split('\n').filter(line => line.trim());
            const ads = document.getElementById('ads').value.split('\n').filter(line => line.trim());
            
            // 获取当前缓存数据
            let currentData = getFromLocalStorage('tvbox_json') || {};
            
            // 更新数据
            currentData.hosts = hosts;
            if (doh) {
                try {
                    currentData.doh = JSON.parse(doh);
                } catch (e) {
                    showNotification('DOH设置JSON格式错误: ' + e.message, true);
                    return;
                }
            } else {
                currentData.doh = [];
            }
            currentData.flags = flags;
            if (rules) {
                try {
                    currentData.rules = JSON.parse(rules);
                } catch (e) {
                    showNotification('规则设置JSON格式错误: ' + e.message, true);
                    return;
                }
            } else {
                currentData.rules = [];
            }
            if (ijk) {
                try {
                    currentData.ijk = JSON.parse(ijk);
                } catch (e) {
                    showNotification('IJK设置JSON格式错误: ' + e.message, true);
                    return;
                }
            } else {
                currentData.ijk = [];
            }
            currentData.proxy = proxy;
            currentData.ads = ads;
            
            // 保存回缓存
            saveToLocalStorage('tvbox_json', currentData);
            
            showNotification('其他设置已锁定！');
        }
        
        // 锁定其他模块
        function lockExtraSettings() {
            const extraText = document.getElementById('extra-json').value;
            
            // 获取当前缓存数据
            let currentData = getFromLocalStorage('tvbox_json') || {};
            
            // 更新数据
            if (extraText.trim()) {
                try {
                    const extraObj = JSON.parse(extraText);
                    currentData.extra = extraObj;
                } catch (e) {
                    showNotification('自定义JSON格式错误: ' + e.message, true);
                    return;
                }
            } else {
                delete currentData.extra;
            }
            
            // 保存回缓存
            saveToLocalStorage('tvbox_json', currentData);
            
            showNotification('其他模块已锁定！');
        }
        
        // 格式化JSON
        function formatJson() {
            const cachedData = getFromLocalStorage('tvbox_json');
            
            if (cachedData) {
                try {
                    const formattedJson = JSON.stringify(cachedData, null, 2);
                    outputContent.textContent = formattedJson;
                    showNotification('JSON已格式化！');
                } catch (e) {
                    showNotification('JSON格式化错误: ' + e.message, true);
                }
            } else {
                showNotification('没有可用的JSON数据', true);
            }
        }
        
        // 导出JSON
        function exportJson() {
            const cachedData = getFromLocalStorage('tvbox_json');
            
            if (cachedData) {
                try {
                    const jsonStr = JSON.stringify(cachedData, null, 2);
                    const blob = new Blob([jsonStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'tvbox_config.json';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showNotification('JSON文件已导出！');
                } catch (e) {
                    showNotification('导出失败: ' + e.message, true);
                }
            } else {
                showNotification('没有可用的JSON数据', true);
            }
        }
        
        // 复制JSON到剪贴板
        function copyJsonToClipboard() {
            const cachedData = getFromLocalStorage('tvbox_json');
            
            if (cachedData) {
                try {
                    navigator.clipboard.writeText(JSON.stringify(cachedData))
                        .then(() => showNotification('JSON已复制到剪贴板！'))
                        .catch(err => showNotification('复制失败: ' + err, true));
                } catch (e) {
                    showNotification('复制失败: ' + e.message, true);
                }
            } else {
                showNotification('没有可用的JSON数据', true);
            }
        }
        
        // 简单加密JSON
        function encryptJson() {
            const cachedData = getFromLocalStorage('tvbox_json');
            
            if (cachedData) {
                try {
                    // 简单加密：Base64编码
                    const encoded = btoa(encodeURIComponent(JSON.stringify(cachedData)));
                    outputContent.textContent = encoded;
                    showNotification('JSON已加密（Base64）！');
                } catch (e) {
                    showNotification('加密失败: ' + e.message, true);
                }
            } else {
                showNotification('没有可用的JSON数据', true);
            }
        }
        
        // 清空所有
        function clearAll() {
            if (confirm('确定要清空所有数据吗？此操作不可撤销！')) {
                removeFromLocalStorage('tvbox_json');
                
                // 重置所有输入框
                document.getElementById('spider').value = '';
                document.getElementById('wallpaper').value = '';
                document.getElementById('logo').value = '';
                document.getElementById('warningText').value = '';
                
                // 清空所有模块
                document.getElementById('sites-container').innerHTML = '';
                document.getElementById('lives-container').innerHTML = '';
                document.getElementById('parses-container').innerHTML = '';
                
                // 清空其他设置
                document.getElementById('hosts').value = '';
                document.getElementById('doh').value = '';
                document.getElementById('flags').value = '';
                document.getElementById('rules').value = '';
                document.getElementById('ijk').value = '';
                document.getElementById('proxy').value = '';
                document.getElementById('ads').value = '';
                
                // 清空其他模块
                document.getElementById('extra-json').value = '';
                
                // 清空粘贴框
                document.getElementById('json-paste').value = '';
                
                // 重新初始化
                addSiteGroup();
                addLiveGroup();
                addParseGroup();
                
                // 清空输出区域
                outputContent.textContent = '格式化或加密后的内容将显示在这里...';
                
                showNotification('所有数据已清空！');
            }
        }
        
        // 复制输出
        function copyOutput() {
            const text = outputContent.textContent;
            if (text && text !== '格式化或加密后的内容将显示在这里...') {
                navigator.clipboard.writeText(text)
                    .then(() => showNotification('输出内容已复制到剪贴板！'))
                    .catch(err => showNotification('复制失败: ' + err, true));
            } else {
                showNotification('没有可复制的内容', true);
            }
        }
        
        // 显示通知
        function showNotification(message, isError = false) {
            notification.textContent = message;
            notification.className = 'notification';
            
            if (isError) {
                notification.classList.add('error');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
