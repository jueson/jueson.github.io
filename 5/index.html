<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TVbox JSONç¼–è¾‘å™¨</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-bg: #f8f9fa;
            --dark-bg: #343a40;
            --border-color: #dee2e6;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            min-height: 600px;
        }
        
        .sidebar {
            width: 250px;
            background: var(--dark-bg);
            color: white;
            padding: 20px 0;
        }
        
        .module-list {
            list-style: none;
        }
        
        .module-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .module-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .module-item.active {
            background: rgba(255, 255, 255, 0.15);
            border-left: 4px solid var(--primary-color);
        }
        
        .editor-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 700px;
        }
        
        .editor-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .section-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: monospace;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .group-container {
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }
        
        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .group-title {
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .group-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .lock-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #777;
        }
        
        .lock-btn.locked {
            color: var(--warning-color);
        }
        
        .add-group-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            margin: 0 0 15px 0;
        }
        
        .add-group-btn i {
            margin-right: 5px;
        }
        
        .footer {
            padding: 20px;
            text-align: center;
            background: var(--light-bg);
            border-top: 1px solid var(--border-color);
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .action-btn {
            padding: 12px 25px;
            font-size: 16px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            background: var(--success-color);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: var(--danger-color);
        }
        
        .hidden {
            display: none;
        }
        
        .input-methods {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .input-method {
            flex: 1;
            padding: 15px;
            border: 2px dashed var(--border-color);
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .input-method:hover {
            border-color: var(--primary-color);
            background: rgba(52, 152, 219, 0.05);
        }
        
        .input-method i {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .two-column-input {
            display: flex;
            gap: 10px;
        }
        
        .two-column-input .form-group {
            flex: 1;
        }
        
        .compact-input {
            font-size: 12px;
            min-height: 60px;
        }
        
        .full-json-input {
            min-height: 120px;
            font-size: 12px;
        }
        
        .output-area {
            margin-top: 20px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 15px;
        }
        
        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .output-title {
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .output-content {
            background: #f8f9fa;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .paste-container {
            position: relative;
        }
        
        .reload-btn {
            position: absolute;
            right: 10px;
            top: 10px;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .input-methods {
                flex-direction: column;
            }
            
            .two-column-input {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-tv"></i> TVbox JSONç¼–è¾‘å™¨</h1>
            <p class="subtitle">å¯è§†åŒ–ç¼–è¾‘TVboxé…ç½®æ–‡ä»¶ï¼Œæ”¯æŒå¯¼å…¥å¯¼å‡ºã€æ ¼å¼åŒ–å’ŒåŠ å¯†</p>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <ul class="module-list">
                    <li class="module-item active" data-module="general"><i class="fas fa-cog"></i> é€šç”¨è®¾ç½®</li>
                    <li class="module-item" data-module="sites"><i class="fas fa-film"></i> ç‚¹æ’­æ¨¡å—</li>
                    <li class="module-item" data-module="lives"><i class="fas fa-satellite"></i> ç›´æ’­æ¨¡å—</li>
                    <li class="module-item" data-module="parses"><i class="fas fa-code"></i> è§£ææ¨¡å—</li>
                    <li class="module-item" data-module="custom"><i class="fas fa-user-cog"></i> è‡ªå®šä¹‰æ¨¡å—</li>
                    <li class="module-item" data-module="others"><i class="fas fa-sliders-h"></i> å…¶ä»–è®¾ç½®</li>
                    <li class="module-item" data-module="advanced"><i class="fas fa-tools"></i> é«˜çº§è®¾ç½®</li>
                </ul>
            </div>
            
            <div class="editor-area">
                <div class="input-methods">
                    <div class="input-method" id="paste-method">
                        <i class="fas fa-paste"></i>
                        <p>ç²˜è´´JSONå†…å®¹</p>
                        <div class="paste-container">
                            <textarea id="json-paste" placeholder="åœ¨æ­¤å¤„ç²˜è´´JSONå†…å®¹..."></textarea>
                            <button class="btn btn-primary reload-btn" id="reload-json">
                                <i class="fas fa-redo"></i> é‡æ–°åŠ è½½
                            </button>
                        </div>
                    </div>
                    <div class="input-method" id="file-method">
                        <i class="fas fa-file-upload"></i>
                        <p>ä¸Šä¼ JSONæ–‡ä»¶</p>
                        <input type="file" id="file-input" accept=".json">
                    </div>
                    <div class="input-method" id="url-method">
                        <i class="fas fa-link"></i>
                        <p>ä»URLåŠ è½½</p>
                        <input type="text" id="url-input" placeholder="è¾“å…¥JSONæ–‡ä»¶URL">
                        <button class="btn btn-primary" id="load-url">åŠ è½½</button>
                    </div>
                </div>
                
                <div id="general-editor" class="editor-section">
                    <h2 class="section-title"><i class="fas fa-cog"></i> é€šç”¨è®¾ç½®</h2>
                    
                    <div class="form-group">
                        <label for="spider">Spider URL</label>
                        <input type="text" id="spider" placeholder="https://example.com/catvod.jar;md5;hash">
                    </div>
                    
                    <div class="form-group">
                        <label for="wallpaper">å£çº¸URL</label>
                        <input type="text" id="wallpaper" placeholder="http://example.com/wallpaper.php">
                    </div>
                    
                    <div class="form-group">
                        <label for="logo">Logo URL</label>
                        <input type="text" id="logo" placeholder="https://example.com/logo.jpg">
                    </div>
                    
                    <div class="form-group">
                        <label for="warningText">è­¦å‘Šæ–‡æœ¬</label>
                        <input type="text" id="warningText" placeholder="å…è´¹èµ„æºï¼Œè¯·å‹¿å……å€¼">
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" id="save-general">ä¿å­˜è®¾ç½®</button>
                        <button class="btn btn-warning" id="reset-general">é‡ç½®</button>
                    </div>
                </div>
                
                <div id="sites-editor" class="editor-section hidden">
                    <h2 class="section-title"><i class="fas fa-film"></i> ç‚¹æ’­æ¨¡å— (sites)</h2>
                    
                    <button class="add-group-btn" id="add-site-group">
                        <i class="fas fa-plus"></i> æ·»åŠ ç«™ç‚¹ç»„
                    </button>
                    
                    <div id="sites-container">
                        <!-- ç«™ç‚¹ç»„å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
                
                <div id="lives-editor" class="editor-section hidden">
                    <h2 class="section-title"><i class="fas fa-satellite"></i> ç›´æ’­æ¨¡å— (lives)</h2>
                    
                    <button class="add-group-btn" id="add-live-group">
                        <i class="fas fa-plus"></i> æ·»åŠ ç›´æ’­æº
                    </button>
                    
                    <div id="lives-container">
                        <!-- ç›´æ’­ç»„å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
                
                <div id="parses-editor" class="editor-section hidden">
                    <h2 class="section-title"><i class="fas fa-code"></i> è§£ææ¨¡å— (parses)</h2>
                    
                    <button class="add-group-btn" id="add-parse-group">
                        <i class="fas fa-plus"></i> æ·»åŠ è§£ææº
                    </button>
                    
                    <div id="parses-container">
                        <!-- è§£æç»„å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
                
                <div id="custom-editor" class="editor-section hidden">
                    <h2 class="section-title"><i class="fas fa-user-cog"></i> è‡ªå®šä¹‰æ¨¡å—</h2>
                    
                    <div class="form-group">
                        <label for="custom-json">è‡ªå®šä¹‰JSONé…ç½®</label>
                        <textarea id="custom-json" placeholder='åœ¨æ­¤å¤„æ·»åŠ è‡ªå®šä¹‰çš„JSONé…ç½®ï¼Œä¾‹å¦‚ï¼š
{
  "customSetting1": "value1",
  "customSetting2": ["item1", "item2"]
}'></textarea>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" id="save-custom">ä¿å­˜è®¾ç½®</button>
                        <button class="btn btn-warning" id="reset-custom">é‡ç½®</button>
                    </div>
                </div>
                
                <div id="others-editor" class="editor-section hidden">
                    <h2 class="section-title"><i class="fas fa-sliders-h"></i> å…¶ä»–è®¾ç½®</h2>
                    
                    <div class="form-group">
                        <label for="hosts">Hosts</label>
                        <textarea id="hosts" placeholder="æ¯è¡Œä¸€ä¸ªhostæ˜ å°„"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="doh">DOHè®¾ç½®</label>
                        <textarea id="doh" placeholder="DNS over HTTPSé…ç½®"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="flags">Flags</label>
                        <textarea id="flags" placeholder="æ¯è¡Œä¸€ä¸ªflag"></textarea>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" id="save-others">ä¿å­˜è®¾ç½®</button>
                        <button class="btn btn-warning" id="reset-others">é‡ç½®</button>
                    </div>
                </div>
                
                <div id="advanced-editor" class="editor-section hidden">
                    <h2 class="section-title"><i class="fas fa-tools"></i> é«˜çº§è®¾ç½®</h2>
                    
                    <div class="form-group">
                        <label for="rules">è§„åˆ™ (rules)</label>
                        <textarea id="rules" placeholder="è§„åˆ™é…ç½®"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="ijk">IJKæ’­æ”¾å™¨è®¾ç½®</label>
                        <textarea id="ijk" placeholder="IJKæ’­æ”¾å™¨é…ç½®"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="proxy">ä»£ç†è®¾ç½®</label>
                        <textarea id="proxy" placeholder="ä»£ç†é…ç½®"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="ads">å¹¿å‘Šè¿‡æ»¤</label>
                        <textarea id="ads" placeholder="å¹¿å‘ŠåŸŸååˆ—è¡¨"></textarea>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" id="save-advanced">ä¿å­˜è®¾ç½®</button>
                        <button class="btn btn-warning" id="reset-advanced">é‡ç½®</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <div class="action-buttons">
                <button class="btn btn-primary action-btn" id="format-json">
                    <i class="fas fa-indent"></i> æ ¼å¼åŒ–JSON
                </button>
                <button class="btn btn-success action-btn" id="export-json">
                    <i class="fas fa-download"></i> å¯¼å‡ºJSON
                </button>
                <button class="btn btn-warning action-btn" id="copy-json">
                    <i class="fas fa-copy"></i> å¤åˆ¶åˆ°å‰ªè´´æ¿
                </button>
                <button class="btn btn-danger action-btn" id="encrypt-json">
                    <i class="fas fa-lock"></i> ç®€å•åŠ å¯†
                </button>
                <button class="btn btn-warning action-btn" id="clear-all">
                    <i class="fas fa-trash"></i> æ¸…ç©ºæ‰€æœ‰
                </button>
            </div>
            
            <div class="output-area">
                <div class="output-header">
                    <div class="output-title">è¾“å‡ºç»“æœ</div>
                    <button class="btn btn-primary" id="copy-output">
                        <i class="fas fa-copy"></i> å¤åˆ¶è¾“å‡º
                    </button>
                </div>
                <div class="output-content" id="output-content">
                    æ ¼å¼åŒ–æˆ–åŠ å¯†åçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        æ“ä½œæˆåŠŸï¼
    </div>
    
    <script>
        // ç¤ºä¾‹JSONæ•°æ®
        const sampleJson = {
            "spider": "https://tvbox.catvod.com/catvod.jar;md5;392df5f6a1c925c9f765c7e4b6f3eda4",
            "wallpaper": "http://æˆ‘ä¸æ˜¯.æ‘¸é±¼å„¿.com/wallpaper/moyu.php",
            "logo": "https://gh-proxy.com/raw.githubusercontent.com/jueson/tvbox/refs/heads/main/SDX1/lib/jueson.jpg",
            "warningText": "å…è´¹èµ„æºï¼Œè¯·å‹¿å……å€¼",
            "sites": [
                {
                    "key": "è±†è±†",
                    "name": "ğŸ…±è±†ç“£â”ƒæ¨è",
                    "type": 3,
                    "api": "csp_DouDouGuard",
                    "indexs": 1,
                    "searchable": 0,
                    "quickSearch": 0,
                    "changeable": 0
                },
                {
                    "key": "MDrive",
                    "name": "ğŸ—‚æˆ‘çš„äº‘ç›˜â”ƒæˆ‘é…ç½®",
                    "type": 3,
                    "api": "csp_MyDriveGuard",
                    "changeable": 0,
                    "indexs": 0,
                    "searchable": 1,
                    "style": {
                        "type": "oval"
                    },
                    "ext": {
                        "Cloud-drive": "tvfan/Cloud-drive.txt"
                    }
                }
            ],
            "lives": [
                {
                    "name": "catvod.com",
                    "type": 0,
                    "url": "https://iptv.catvod.com/tv.m3u"
                }
            ],
            "parses": [
                {
                    "name": "VIP1",
                    "type": 0,
                    "url": "https://jx.xmflv.com/?url="
                }
            ],
            "hosts": [
                "cache.ott.ystenlive.itv.cmvideo.cn=base-v4-free-mghy.e.cdn.chinamobile.com"
            ],
            "doh": [
                {
                    "name": "Google",
                    "url": "https://dns.google/dns-query",
                    "ips": ["8.8.4.4", "8.8.8.8"]
                }
            ],
            "flags": ["youku", "qq", "iqiyi"],
            "rules": [
                {
                    "name": "proxy",
                    "hosts": ["raw.githubusercontent.com", "googlevideo.com"]
                }
            ],
            "ijk": [
                {
                    "group": "è½¯è§£ç ",
                    "options": [
                        {"category": 4, "name": "mediacodec", "value": "0"}
                    ]
                }
            ],
            "proxy": ["raw.githubusercontent.com", "googlevideo.com"],
            "ads": ["wan.51img1.com"]
        };

        // DOMå…ƒç´ 
        const moduleItems = document.querySelectorAll('.module-item');
        const editorSections = document.querySelectorAll('.editor-section');
        const notification = document.getElementById('notification');
        const outputContent = document.getElementById('output-content');
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½ç¼“å­˜æ•°æ®
            loadFromCache();
            
            // è®¾ç½®æ¨¡å—åˆ‡æ¢
            moduleItems.forEach(item => {
                item.addEventListener('click', () => {
                    // æ›´æ–°æ´»åŠ¨æ¨¡å—
                    moduleItems.forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    
                    // æ˜¾ç¤ºå¯¹åº”ç¼–è¾‘å™¨
                    const moduleId = item.dataset.module;
                    editorSections.forEach(section => {
                        section.classList.add('hidden');
                    });
                    document.getElementById(`${moduleId}-editor`).classList.remove('hidden');
                });
            });
            
            // è®¾ç½®è¾“å…¥æ–¹æ³•
            setupInputMethods();
            
            // è®¾ç½®æŒ‰é’®äº‹ä»¶
            setupButtonEvents();
            
            // åˆå§‹åŒ–ç«™ç‚¹ç¼–è¾‘å™¨
            initSitesEditor();
            initLivesEditor();
            initParsesEditor();
        });
        
        // è®¾ç½®è¾“å…¥æ–¹æ³•
        function setupInputMethods() {
            // ç²˜è´´æ–¹æ³•
            const jsonPaste = document.getElementById('json-paste');
            jsonPaste.addEventListener('input', function() {
                if (this.value.trim()) {
                    try {
                        const jsonData = JSON.parse(this.value);
                        loadJsonData(jsonData);
                        showNotification('JSONåŠ è½½æˆåŠŸï¼');
                    } catch (e) {
                        showNotification('JSONæ ¼å¼é”™è¯¯: ' + e.message, true);
                    }
                }
            });
            
            // æ–‡ä»¶ä¸Šä¼ 
            const fileInput = document.getElementById('file-input');
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const jsonData = JSON.parse(event.target.result);
                            // å°†å†…å®¹æ˜¾ç¤ºåˆ°ç²˜è´´è¾“å…¥æ¡†
                            jsonPaste.value = JSON.stringify(jsonData, null, 2);
                            loadJsonData(jsonData);
                            showNotification('æ–‡ä»¶åŠ è½½æˆåŠŸï¼');
                        } catch (e) {
                            showNotification('JSONè§£æé”™è¯¯: ' + e.message, true);
                        }
                    };
                    reader.readAsText(file);
                }
            });
            
            // URLåŠ è½½
            const loadUrlBtn = document.getElementById('load-url');
            loadUrlBtn.addEventListener('click', function() {
                const urlInput = document.getElementById('url-input');
                const url = urlInput.value.trim();
                if (url) {
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            // å°†å†…å®¹æ˜¾ç¤ºåˆ°ç²˜è´´è¾“å…¥æ¡†
                            jsonPaste.value = JSON.stringify(data, null, 2);
                            loadJsonData(data);
                            showNotification('URLåŠ è½½æˆåŠŸï¼');
                        })
                        .catch(error => {
                            showNotification('åŠ è½½å¤±è´¥: ' + error.message, true);
                        });
                } else {
                    showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„URL', true);
                }
            });
            
            // é‡æ–°åŠ è½½æŒ‰é’®
            document.getElementById('reload-json').addEventListener('click', function() {
                const cachedData = localStorage.getItem('tvbox_json');
                if (cachedData) {
                    try {
                        const jsonData = JSON.parse(cachedData);
                        jsonPaste.value = JSON.stringify(jsonData, null, 2);
                        showNotification('å·²ä»ç¼“å­˜é‡æ–°åŠ è½½ï¼');
                    } catch (e) {
                        showNotification('é‡æ–°åŠ è½½å¤±è´¥: ' + e.message, true);
                    }
                } else {
                    showNotification('æ²¡æœ‰å¯ç”¨çš„ç¼“å­˜æ•°æ®', true);
                }
            });
        }
        
        // è®¾ç½®æŒ‰é’®äº‹ä»¶
        function setupButtonEvents() {
            // æ ¼å¼åŒ–JSON
            document.getElementById('format-json').addEventListener('click', formatJson);
            
            // å¯¼å‡ºJSON
            document.getElementById('export-json').addEventListener('click', exportJson);
            
            // å¤åˆ¶JSON
            document.getElementById('copy-json').addEventListener('click', copyJsonToClipboard);
            
            // åŠ å¯†JSON
            document.getElementById('encrypt-json').addEventListener('click', encryptJson);
            
            // æ¸…ç©ºæ‰€æœ‰
            document.getElementById('clear-all').addEventListener('click', clearAll);
            
            // å¤åˆ¶è¾“å‡º
            document.getElementById('copy-output').addEventListener('click', copyOutput);
            
            // ä¿å­˜é€šç”¨è®¾ç½®
            document.getElementById('save-general').addEventListener('click', saveGeneralSettings);
            
            // é‡ç½®é€šç”¨è®¾ç½®
            document.getElementById('reset-general').addEventListener('click', resetGeneralSettings);
            
            // æ·»åŠ ç«™ç‚¹ç»„
            document.getElementById('add-site-group').addEventListener('click', addSiteGroup);
            
            // æ·»åŠ ç›´æ’­æº
            document.getElementById('add-live-group').addEventListener('click', addLiveGroup);
            
            // æ·»åŠ è§£ææº
            document.getElementById('add-parse-group').addEventListener('click', addParseGroup);
            
            // ä¿å­˜è‡ªå®šä¹‰è®¾ç½®
            document.getElementById('save-custom').addEventListener('click', saveCustomSettings);
            
            // é‡ç½®è‡ªå®šä¹‰è®¾ç½®
            document.getElementById('reset-custom').addEventListener('click', resetCustomSettings);
            
            // ä¿å­˜å…¶ä»–è®¾ç½®
            document.getElementById('save-others').addEventListener('click', saveOthersSettings);
            
            // é‡ç½®å…¶ä»–è®¾ç½®
            document.getElementById('reset-others').addEventListener('click', resetOthersSettings);
            
            // ä¿å­˜é«˜çº§è®¾ç½®
            document.getElementById('save-advanced').addEventListener('click', saveAdvancedSettings);
            
            // é‡ç½®é«˜çº§è®¾ç½®
            document.getElementById('reset-advanced').addEventListener('click', resetAdvancedSettings);
        }
        
        // åŠ è½½JSONæ•°æ®åˆ°ç¼–è¾‘å™¨
        function loadJsonData(data) {
            // ä¿å­˜åˆ°ç¼“å­˜
            localStorage.setItem('tvbox_json', JSON.stringify(data));
            
            // å¡«å……é€šç”¨è®¾ç½®
            document.getElementById('spider').value = data.spider || '';
            document.getElementById('wallpaper').value = data.wallpaper || '';
            document.getElementById('logo').value = data.logo || '';
            document.getElementById('warningText').value = data.warningText || '';
            
            // å¡«å……ç«™ç‚¹
            populateSites(data.sites || []);
            
            // å¡«å……ç›´æ’­
            populateLives(data.lives || []);
            
            // å¡«å……è§£æ
            populateParses(data.parses || []);
            
            // å¡«å……è‡ªå®šä¹‰è®¾ç½®
            if (data.custom) {
                document.getElementById('custom-json').value = JSON.stringify(data.custom, null, 2);
            } else {
                document.getElementById('custom-json').value = '';
            }
            
            // å¡«å……å…¶ä»–è®¾ç½®
            document.getElementById('hosts').value = Array.isArray(data.hosts) ? data.hosts.join('\n') : '';
            document.getElementById('doh').value = JSON.stringify(data.doh || [], null, 2);
            document.getElementById('flags').value = Array.isArray(data.flags) ? data.flags.join('\n') : '';
            
            // å¡«å……é«˜çº§è®¾ç½®
            document.getElementById('rules').value = JSON.stringify(data.rules || [], null, 2);
            document.getElementById('ijk').value = JSON.stringify(data.ijk || [], null, 2);
            document.getElementById('proxy').value = Array.isArray(data.proxy) ? data.proxy.join('\n') : '';
            document.getElementById('ads').value = Array.isArray(data.ads) ? data.ads.join('\n') : '';
            
            showNotification('æ•°æ®åŠ è½½æˆåŠŸï¼');
        }
        
        // ä»ç¼“å­˜åŠ è½½æ•°æ®
        function loadFromCache() {
            const cachedData = localStorage.getItem('tvbox_json');
            if (cachedData) {
                try {
                    const jsonData = JSON.parse(cachedData);
                    loadJsonData(jsonData);
                } catch (e) {
                    console.error('ç¼“å­˜æ•°æ®è§£æé”™è¯¯:', e);
                }
            } else {
                // åŠ è½½ç¤ºä¾‹æ•°æ®
                loadJsonData(sampleJson);
            }
        }
        
        // åˆå§‹åŒ–ç«™ç‚¹ç¼–è¾‘å™¨
        function initSitesEditor() {
            document.getElementById('sites-container').innerHTML = '';
            // åˆå§‹æ·»åŠ ä¸€ä¸ªç©ºç»„
            addSiteGroup();
        }
        
        // æ·»åŠ ç«™ç‚¹ç»„
        function addSiteGroup() {
            const container = document.getElementById('sites-container');
            const groupId = Date.now();
            
            const groupHtml = `
                <div class="group-container" id="site-group-${groupId}">
                    <div class="group-header">
                        <div class="group-title">ç«™ç‚¹ç»„ ${container.children.length + 1}</div>
                    </div>
                    <div class="two-column-input">
                        <div class="form-group">
                            <label>Key</label>
                            <input type="text" class="site-key" placeholder="å”¯ä¸€æ ‡è¯†ç¬¦" oninput="autoSaveModule('sites')">
                        </div>
                        <div class="form-group">
                            <label>åç§°</label>
                            <input type="text" class="site-name" placeholder="æ˜¾ç¤ºåç§°" oninput="autoSaveModule('sites')">
                        </div>
                    </div>
                    <div class="two-column-input">
                        <div class="form-group">
                            <label>ç±»å‹ (type)</label>
                            <input type="number" class="site-type" value="3" oninput="autoSaveModule('sites')">
                        </div>
                        <div class="form-group">
                            <label>API</label>
                            <input type="text" class="site-api" placeholder="APIåç§°" oninput="autoSaveModule('sites')">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>å…¶ä»–è®¾ç½® (æ— éœ€æœ€å¤–å±‚{})</label>
                        <textarea class="site-extras compact-input" placeholder='"indexs": 1, "searchable": 0, "quickSearch": 0, "changeable": 0' oninput="autoSaveModule('sites')"></textarea>
                    </div>
                    <div class="group-actions">
                        <button class="btn btn-danger delete-group" data-group="${groupId}">
                            <i class="fas fa-trash"></i> åˆ é™¤
                        </button>
                        <button class="lock-btn" data-group="${groupId}">
                            <i class="fas fa-lock-open"></i> é”å®š
                        </button>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', groupHtml);
            
            // æ·»åŠ åˆ é™¤äº‹ä»¶
            document.querySelector(`#site-group-${groupId} .delete-group`).addEventListener('click', function() {
                document.getElementById(`site-group-${groupId}`).remove();
                autoSaveModule('sites');
            });
            
            // æ·»åŠ é”å®šäº‹ä»¶
            document.querySelector(`#site-group-${groupId} .lock-btn`).addEventListener('click', function() {
                const icon = this.querySelector('i');
                if (icon.classList.contains('fa-lock-open')) {
                    icon.classList.remove('fa-lock-open');
                    icon.classList.add('fa-lock');
                    this.classList.add('locked');
                } else {
                    icon.classList.remove('fa-lock');
                    icon.classList.add('fa-lock-open');
                    this.classList.remove('locked');
                }
            });
        }
        
        // å¡«å……ç«™ç‚¹æ•°æ®
        function populateSites(sites) {
            const container = document.getElementById('sites-container');
            container.innerHTML = '';
            
            sites.forEach((site, index) => {
                const groupId = `site-${Date.now()}-${index}`;
                
                // æå–é¢å¤–è®¾ç½®
                const { key, name, type, api, ...extras } = site;
                
                // æ„å»ºé¢å¤–è®¾ç½®å­—ç¬¦ä¸²ï¼ˆä¸åŒ…å«æœ€å¤–å±‚å¤§æ‹¬å·ï¼‰
                let extrasStr = '';
                const extrasEntries = Object.entries(extras);
                extrasEntries.forEach(([k, v], idx) => {
                    if (typeof v === 'object') {
                        extrasStr += `"${k}": ${JSON.stringify(v)}`;
                    } else {
                        extrasStr += `"${k}": ${JSON.stringify(v)}`;
                    }
                    if (idx < extrasEntries.length - 1) {
                        extrasStr += ', ';
                    }
                });
                
                const groupHtml = `
                    <div class="group-container" id="${groupId}">
                        <div class="group-header">
                            <div class="group-title">${site.name || 'ç«™ç‚¹ç»„'}</div>
                        </div>
                        <div class="two-column-input">
                            <div class="form-group">
                                <label>Key</label>
                                <input type="text" class="site-key" value="${site.key || ''}" placeholder="å”¯ä¸€æ ‡è¯†ç¬¦" oninput="autoSaveModule('sites')">
                            </div>
                            <div class="form-group">
                                <label>åç§°</label>
                                <input type="text" class="site-name" value="${site.name || ''}" placeholder="æ˜¾ç¤ºåç§°" oninput="autoSaveModule('sites')">
                            </div>
                        </div>
                        <div class="two-column-input">
                            <div class="form-group">
                                <label>ç±»å‹ (type)</label>
                                <input type="number" class="site-type" value="${site.type || 3}" oninput="autoSaveModule('sites')">
                            </div>
                            <div class="form-group">
                                <label>API</label>
                                <input type="text" class="site-api" value="${site.api || ''}" placeholder="APIåç§°" oninput="autoSaveModule('sites')">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>å…¶ä»–è®¾ç½® (æ— éœ€æœ€å¤–å±‚{})</label>
                            <textarea class="site-extras compact-input" placeholder='"key": "value"' oninput="autoSaveModule('sites')">${extrasStr}</textarea>
                        </div>
                        <div class="group-actions">
                            <button class="btn btn-danger delete-group" data-group="${groupId}">
                                <i class="fas fa-trash"></i> åˆ é™¤
                            </button>
                            <button class="lock-btn locked" data-group="${groupId}">
                                <i class="fas fa-lock"></i> è§£é”
                            </button>
                        </div>
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', groupHtml);
                
                // æ·»åŠ åˆ é™¤äº‹ä»¶
                document.querySelector(`#${groupId} .delete-group`).addEventListener('click', function() {
                    document.getElementById(groupId).remove();
                    autoSaveModule('sites');
                });
                
                // æ·»åŠ é”å®šäº‹ä»¶
                document.querySelector(`#${groupId} .lock-btn`).addEventListener('click', function() {
                    const icon = this.querySelector('i');
                    if (icon.classList.contains('fa-lock-open')) {
                        icon.classList.remove('fa-lock-open');
                        icon.classList.add('fa-lock');
                        this.classList.add('locked');
                    } else {
                        icon.classList.remove('fa-lock');
                        icon.classList.add('fa-lock-open');
                        this.classList.remove('locked');
                    }
                });
            });
        }
        
        // åˆå§‹åŒ–ç›´æ’­ç¼–è¾‘å™¨
        function initLivesEditor() {
            document.getElementById('lives-container').innerHTML = '';
            // åˆå§‹æ·»åŠ ä¸€ä¸ªç©ºç»„
            addLiveGroup();
        }
        
        // æ·»åŠ ç›´æ’­æº
        function addLiveGroup() {
            const container = document.getElementById('lives-container');
            const groupId = Date.now();
            
            const groupHtml = `
                <div class="group-container" id="live-group-${groupId}">
                    <div class="group-header">
                        <div class="group-title">ç›´æ’­æº ${container.children.length + 1}</div>
                    </div>
                    <div class="form-group">
                        <label>åç§°</label>
                        <input type="text" class="live-name" placeholder="ç›´æ’­æºåç§°" oninput="autoSaveModule('lives')">
                    </div>
                    <div class="form-group">
                        <label>URL</label>
                        <input type="text" class="live-url" placeholder="ç›´æ’­æºURL" oninput="autoSaveModule('lives')">
                    </div>
                    <div class="form-group">
                        <label>å…¶ä»–è®¾ç½® (æ— éœ€æœ€å¤–å±‚{})</label>
                        <textarea class="live-extras compact-input" placeholder='"type": 0' oninput="autoSaveModule('lives')"></textarea>
                    </div>
                    <div class="group-actions">
                        <button class="btn btn-danger delete-group" data-group="${groupId}">
                            <i class="fas fa-trash"></i> åˆ é™¤
                        </button>
                        <button class="lock-btn" data-group="${groupId}">
                            <i class="fas fa-lock-open"></i> é”å®š
                        </button>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', groupHtml);
            
            // æ·»åŠ åˆ é™¤äº‹ä»¶
            document.querySelector(`#live-group-${groupId} .delete-group`).addEventListener('click', function() {
                document.getElementById(`live-group-${groupId}`).remove();
                autoSaveModule('lives');
            });
            
            // æ·»åŠ é”å®šäº‹ä»¶
            document.querySelector(`#live-group-${groupId} .lock-btn`).addEventListener('click', function() {
                const icon = this.querySelector('i');
                if (icon.classList.contains('fa-lock-open')) {
                    icon.classList.remove('fa-lock-open');
                    icon.classList.add('fa-lock');
                    this.classList.add('locked');
                } else {
                    icon.classList.remove('fa-lock');
                    icon.classList.add('fa-lock-open');
                    this.classList.remove('locked');
                }
            });
        }
        
        // å¡«å……ç›´æ’­æ•°æ®
        function populateLives(lives) {
            const container = document.getElementById('lives-container');
            container.innerHTML = '';
            
            lives.forEach((live, index) => {
                const groupId = `live-${Date.now()}-${index}`;
                
                // æå–é¢å¤–è®¾ç½®
                const { name, url, ...extras } = live;
                
                // æ„å»ºé¢å¤–è®¾ç½®å­—ç¬¦ä¸²ï¼ˆä¸åŒ…å«æœ€å¤–å±‚å¤§æ‹¬å·ï¼‰
                let extrasStr = '';
                const extrasEntries = Object.entries(extras);
                extrasEntries.forEach(([k, v], idx) => {
                    extrasStr += `"${k}": ${JSON.stringify(v)}`;
                    if (idx < extrasEntries.length - 1) {
                        extrasStr += ', ';
                    }
                });
                
                const groupHtml = `
                    <div class="group-container" id="${groupId}">
                        <div class="group-header">
                            <div class="group-title">${live.name || 'ç›´æ’­æº'}</div>
                        </div>
                        <div class="form-group">
                            <label>åç§°</label>
                            <input type="text" class="live-name" value="${live.name || ''}" placeholder="ç›´æ’­æºåç§°" oninput="autoSaveModule('lives')">
                        </div>
                        <div class="form-group">
                            <label>URL</label>
                            <input type="text" class="live-url" value="${live.url || ''}" placeholder="ç›´æ’­æºURL" oninput="autoSaveModule('lives')">
                        </div>
                        <div class="form-group">
                            <label>å…¶ä»–è®¾ç½® (æ— éœ€æœ€å¤–å±‚{})</label>
                            <textarea class="live-extras compact-input" placeholder='"type": 0' oninput="autoSaveModule('lives')">${extrasStr}</textarea>
                        </div>
                        <div class="group-actions">
                            <button class="btn btn-danger delete-group" data-group="${groupId}">
                                <i class="fas fa-trash"></i> åˆ é™¤
                            </button>
                            <button class="lock-btn locked" data-group="${groupId}">
                                <i class="fas fa-lock"></i> è§£é”
                            </button>
                        </div>
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', groupHtml);
                
                // æ·»åŠ åˆ é™¤äº‹ä»¶
                document.querySelector(`#${groupId} .delete-group`).addEventListener('click', function() {
                    document.getElementById(groupId).remove();
                    autoSaveModule('lives');
                });
                
                // æ·»åŠ é”å®šäº‹ä»¶
                document.querySelector(`#${groupId} .lock-btn`).addEventListener('click', function() {
                    const icon = this.querySelector('i');
                    if (icon.classList.contains('fa-lock-open')) {
                        icon.classList.remove('fa-lock-open');
                        icon.classList.add('fa-lock');
                        this.classList.add('locked');
                    } else {
                        icon.classList.remove('fa-lock');
                        icon.classList.add('fa-lock-open');
                        this.classList.remove('locked');
                    }
                });
            });
        }
        
        // åˆå§‹åŒ–è§£æç¼–è¾‘å™¨
        function initParsesEditor() {
            document.getElementById('parses-container').innerHTML = '';
            // åˆå§‹æ·»åŠ ä¸€ä¸ªç©ºç»„
            addParseGroup();
        }
        
        // æ·»åŠ è§£ææº
        function addParseGroup() {
            const container = document.getElementById('parses-container');
            const groupId = Date.now();
            
            const groupHtml = `
                <div class="group-container" id="parse-group-${groupId}">
                    <div class="group-header">
                        <div class="group-title">è§£ææº ${container.children.length + 1}</div>
                    </div>
                    <div class="form-group">
                        <label>å®Œæ•´é…ç½® (JSONæ ¼å¼)</label>
                        <textarea class="parse-full full-json-input" placeholder='{"name": "VIP1", "type": 0, "url": "https://jx.xmflv.com/?url="}' oninput="autoSaveModule('parses')"></textarea>
                    </div>
                    <div class="group-actions">
                        <button class="btn btn-danger delete-group" data-group="${groupId}">
                            <i class="fas fa-trash"></i> åˆ é™¤
                        </button>
                        <button class="lock-btn" data-group="${groupId}">
                            <i class="fas fa-lock-open"></i> é”å®š
                        </button>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', groupHtml);
            
            // æ·»åŠ åˆ é™¤äº‹ä»¶
            document.querySelector(`#parse-group-${groupId} .delete-group`).addEventListener('click', function() {
                document.getElementById(`parse-group-${groupId}`).remove();
                autoSaveModule('parses');
            });
            
            // æ·»åŠ é”å®šäº‹ä»¶
            document.querySelector(`#parse-group-${groupId} .lock-btn`).addEventListener('click', function() {
                const icon = this.querySelector('i');
                if (icon.classList.contains('fa-lock-open')) {
                    icon.classList.remove('fa-lock-open');
                    icon.classList.add('fa-lock');
                    this.classList.add('locked');
                } else {
                    icon.classList.remove('fa-lock');
                    icon.classList.add('fa-lock-open');
                    this.classList.remove('locked');
                }
            });
        }
        
        // å¡«å……è§£ææ•°æ®
        function populateParses(parses) {
            const container = document.getElementById('parses-container');
            container.innerHTML = '';
            
            parses.forEach((parse, index) => {
                const groupId = `parse-${Date.now()}-${index}`;
                
                const groupHtml = `
                    <div class="group-container" id="${groupId}">
                        <div class="group-header">
                            <div class="group-title">${parse.name || 'è§£ææº'}</div>
                        </div>
                        <div class="form-group">
                            <label>å®Œæ•´é…ç½® (JSONæ ¼å¼)</label>
                            <textarea class="parse-full full-json-input" placeholder='{"name": "VIP1", "type": 0, "url": "https://jx.xmflv.com/?url="}' oninput="autoSaveModule('parses')">${JSON.stringify(parse, null, 2)}</textarea>
                        </div>
                        <div class="group-actions">
                            <button class="btn btn-danger delete-group" data-group="${groupId}">
                                <i class="fas fa-trash"></i> åˆ é™¤
                            </button>
                            <button class="lock-btn locked" data-group="${groupId}">
                                <i class="fas fa-lock"></i> è§£é”
                            </button>
                        </div>
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', groupHtml);
                
                // æ·»åŠ åˆ é™¤äº‹ä»¶
                document.querySelector(`#${groupId} .delete-group`).addEventListener('click', function() {
                    document.getElementById(groupId).remove();
                    autoSaveModule('parses');
                });
                
                // æ·»åŠ é”å®šäº‹ä»¶
                document.querySelector(`#${groupId} .lock-btn`).addEventListener('click', function() {
                    const icon = this.querySelector('i');
                    if (icon.classList.contains('fa-lock-open')) {
                        icon.classList.remove('fa-lock-open');
                        icon.classList.add('fa-lock');
                        this.classList.add('locked');
                    } else {
                        icon.classList.remove('fa-lock');
                        icon.classList.add('fa-lock-open');
                        this.classList.remove('locked');
                    }
                });
            });
        }
        
        // è‡ªåŠ¨ä¿å­˜æ¨¡å—
        function autoSaveModule(moduleName) {
            let moduleData = {};
            
            if (moduleName === 'sites') {
                const groups = document.querySelectorAll('#sites-container .group-container');
                const sites = [];
                
                groups.forEach(group => {
                    const key = group.querySelector('.site-key').value;
                    const name = group.querySelector('.site-name').value;
                    const type = parseInt(group.querySelector('.site-type').value);
                    const api = group.querySelector('.site-api').value;
                    const extrasText = group.querySelector('.site-extras').value;
                    
                    if (key && name) {
                        const site = { key, name, type, api };
                        
                        // è§£æé¢å¤–è®¾ç½®
                        if (extrasText.trim()) {
                            try {
                                // æ·»åŠ æœ€å¤–å±‚å¤§æ‹¬å·
                                let extrasJsonStr = extrasText.trim();
                                if (!extrasJsonStr.startsWith('{')) {
                                    extrasJsonStr = '{' + extrasJsonStr;
                                }
                                if (!extrasJsonStr.endsWith('}')) {
                                    extrasJsonStr = extrasJsonStr + '}';
                                }
                                const extrasObj = JSON.parse(extrasJsonStr);
                                Object.assign(site, extrasObj);
                            } catch (e) {
                                console.warn('è§£æé¢å¤–è®¾ç½®å¤±è´¥:', e);
                            }
                        }
                        
                        sites.push(site);
                    }
                });
                
                moduleData = sites;
            } else if (moduleName === 'lives') {
                const groups = document.querySelectorAll('#lives-container .group-container');
                const lives = [];
                
                groups.forEach(group => {
                    const name = group.querySelector('.live-name').value;
                    const url = group.querySelector('.live-url').value;
                    const extrasText = group.querySelector('.live-extras').value;
                    
                    if (name && url) {
                        const live = { name, url };
                        
                        // è§£æé¢å¤–è®¾ç½®
                        if (extrasText.trim()) {
                            try {
                                // æ·»åŠ æœ€å¤–å±‚å¤§æ‹¬å·
                                let extrasJsonStr = extrasText.trim();
                                if (!extrasJsonStr.startsWith('{')) {
                                    extrasJsonStr = '{' + extrasJsonStr;
                                }
                                if (!extrasJsonStr.endsWith('}')) {
                                    extrasJsonStr = extrasJsonStr + '}';
                                }
                                const extrasObj = JSON.parse(extrasJsonStr);
                                Object.assign(live, extrasObj);
                            } catch (e) {
                                console.warn('è§£æé¢å¤–è®¾ç½®å¤±è´¥:', e);
                            }
                        }
                        
                        lives.push(live);
                    }
                });
                
                moduleData = lives;
            } else if (moduleName === 'parses') {
                const groups = document.querySelectorAll('#parses-container .group-container');
                const parses = [];
                
                groups.forEach(group => {
                    const fullText = group.querySelector('.parse-full').value;
                    
                    if (fullText.trim()) {
                        try {
                            const parseObj = JSON.parse(fullText);
                            parses.push(parseObj);
                        } catch (e) {
                            console.warn('è§£æé…ç½®å¤±è´¥:', e);
                        }
                    }
                });
                
                moduleData = parses;
            }
            
            // è·å–å½“å‰ç¼“å­˜æ•°æ®
            let currentData = JSON.parse(localStorage.getItem('tvbox_json') || '{}');
            
            // æ›´æ–°æ•°æ®
            currentData[moduleName] = moduleData;
            
            // ä¿å­˜å›ç¼“å­˜
            localStorage.setItem('tvbox_json', JSON.stringify(currentData));
        }
        
        // ä¿å­˜é€šç”¨è®¾ç½®
        function saveGeneralSettings() {
            const spider = document.getElementById('spider').value;
            const wallpaper = document.getElementById('wallpaper').value;
            const logo = document.getElementById('logo').value;
            const warningText = document.getElementById('warningText').value;
            
            // è·å–å½“å‰ç¼“å­˜æ•°æ®
            let currentData = JSON.parse(localStorage.getItem('tvbox_json') || '{}');
            
            // æ›´æ–°æ•°æ®
            currentData.spider = spider;
            currentData.wallpaper = wallpaper;
            currentData.logo = logo;
            currentData.warningText = warningText;
            
            // ä¿å­˜å›ç¼“å­˜
            localStorage.setItem('tvbox_json', JSON.stringify(currentData));
            
            showNotification('é€šç”¨è®¾ç½®å·²ä¿å­˜ï¼');
        }
        
        // é‡ç½®é€šç”¨è®¾ç½®
        function resetGeneralSettings() {
            if (confirm('ç¡®å®šè¦é‡ç½®é€šç”¨è®¾ç½®å—ï¼Ÿ')) {
                document.getElementById('spider').value = '';
                document.getElementById('wallpaper').value = '';
                document.getElementById('logo').value = '';
                document.getElementById('warningText').value = '';
                showNotification('é€šç”¨è®¾ç½®å·²é‡ç½®ï¼');
            }
        }
        
        // ä¿å­˜è‡ªå®šä¹‰è®¾ç½®
        function saveCustomSettings() {
            const customText = document.getElementById('custom-json').value;
            
            // è·å–å½“å‰ç¼“å­˜æ•°æ®
            let currentData = JSON.parse(localStorage.getItem('tvbox_json') || '{}');
            
            // æ›´æ–°æ•°æ®
            if (customText.trim()) {
                try {
                    const customObj = JSON.parse(customText);
                    currentData.custom = customObj;
                } catch (e) {
                    showNotification('è‡ªå®šä¹‰JSONæ ¼å¼é”™è¯¯: ' + e.message, true);
                    return;
                }
            } else {
                delete currentData.custom;
            }
            
            // ä¿å­˜å›ç¼“å­˜
            localStorage.setItem('tvbox_json', JSON.stringify(currentData));
            
            showNotification('è‡ªå®šä¹‰è®¾ç½®å·²ä¿å­˜ï¼');
        }
        
        // é‡ç½®è‡ªå®šä¹‰è®¾ç½®
        function resetCustomSettings() {
            if (confirm('ç¡®å®šè¦é‡ç½®è‡ªå®šä¹‰è®¾ç½®å—ï¼Ÿ')) {
                document.getElementById('custom-json').value = '';
                showNotification('è‡ªå®šä¹‰è®¾ç½®å·²é‡ç½®ï¼');
            }
        }
        
        // ä¿å­˜å…¶ä»–è®¾ç½®
        function saveOthersSettings() {
            const hosts = document.getElementById('hosts').value.split('\n').filter(line => line.trim());
            const doh = document.getElementById('doh').value;
            const flags = document.getElementById('flags').value.split('\n').filter(line => line.trim());
            
            // è·å–å½“å‰ç¼“å­˜æ•°æ®
            let currentData = JSON.parse(localStorage.getItem('tvbox_json') || '{}');
            
            // æ›´æ–°æ•°æ®
            currentData.hosts = hosts;
            currentData.doh = doh ? JSON.parse(doh) : [];
            currentData.flags = flags;
            
            // ä¿å­˜å›ç¼“å­˜
            localStorage.setItem('tvbox_json', JSON.stringify(currentData));
            
            showNotification('å…¶ä»–è®¾ç½®å·²ä¿å­˜ï¼');
        }
        
        // é‡ç½®å…¶ä»–è®¾ç½®
        function resetOthersSettings() {
            if (confirm('ç¡®å®šè¦é‡ç½®å…¶ä»–è®¾ç½®å—ï¼Ÿ')) {
                document.getElementById('hosts').value = '';
                document.getElementById('doh').value = '';
                document.getElementById('flags').value = '';
                showNotification('å…¶ä»–è®¾ç½®å·²é‡ç½®ï¼');
            }
        }
        
        // ä¿å­˜é«˜çº§è®¾ç½®
        function saveAdvancedSettings() {
            const rules = document.getElementById('rules').value;
            const ijk = document.getElementById('ijk').value;
            const proxy = document.getElementById('proxy').value.split('\n').filter(line => line.trim());
            const ads = document.getElementById('ads').value.split('\n').filter(line => line.trim());
            
            // è·å–å½“å‰ç¼“å­˜æ•°æ®
            let currentData = JSON.parse(localStorage.getItem('tvbox_json') || '{}');
            
            // æ›´æ–°æ•°æ®
            currentData.rules = rules ? JSON.parse(rules) : [];
            currentData.ijk = ijk ? JSON.parse(ijk) : [];
            currentData.proxy = proxy;
            currentData.ads = ads;
            
            // ä¿å­˜å›ç¼“å­˜
            localStorage.setItem('tvbox_json', JSON.stringify(currentData));
            
            showNotification('é«˜çº§è®¾ç½®å·²ä¿å­˜ï¼');
        }
        
        // é‡ç½®é«˜çº§è®¾ç½®
        function resetAdvancedSettings() {
            if (confirm('ç¡®å®šè¦é‡ç½®é«˜çº§è®¾ç½®å—ï¼Ÿ')) {
                document.getElementById('rules').value = '';
                document.getElementById('ijk').value = '';
                document.getElementById('proxy').value = '';
                document.getElementById('ads').value = '';
                showNotification('é«˜çº§è®¾ç½®å·²é‡ç½®ï¼');
            }
        }
        
        // æ ¼å¼åŒ–JSON
        function formatJson() {
            const cachedData = localStorage.getItem('tvbox_json');
            
            if (cachedData) {
                try {
                    const jsonObj = JSON.parse(cachedData);
                    const formattedJson = JSON.stringify(jsonObj, null, 2);
                    outputContent.textContent = formattedJson;
                    showNotification('JSONå·²æ ¼å¼åŒ–ï¼');
                } catch (e) {
                    showNotification('JSONæ ¼å¼åŒ–é”™è¯¯: ' + e.message, true);
                }
            } else {
                showNotification('æ²¡æœ‰å¯ç”¨çš„JSONæ•°æ®', true);
            }
        }
        
        // å¯¼å‡ºJSON
        function exportJson() {
            const cachedData = localStorage.getItem('tvbox_json');
            
            if (cachedData) {
                try {
                    const jsonObj = JSON.parse(cachedData);
                    const jsonStr = JSON.stringify(jsonObj, null, 2);
                    const blob = new Blob([jsonStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'tvbox_config.json';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showNotification('JSONæ–‡ä»¶å·²å¯¼å‡ºï¼');
                } catch (e) {
                    showNotification('å¯¼å‡ºå¤±è´¥: ' + e.message, true);
                }
            } else {
                showNotification('æ²¡æœ‰å¯ç”¨çš„JSONæ•°æ®', true);
            }
        }
        
        // å¤åˆ¶JSONåˆ°å‰ªè´´æ¿
        function copyJsonToClipboard() {
            const cachedData = localStorage.getItem('tvbox_json');
            
            if (cachedData) {
                try {
                    navigator.clipboard.writeText(cachedData)
                        .then(() => showNotification('JSONå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼'))
                        .catch(err => showNotification('å¤åˆ¶å¤±è´¥: ' + err, true));
                } catch (e) {
                    showNotification('å¤åˆ¶å¤±è´¥: ' + e.message, true);
                }
            } else {
                showNotification('æ²¡æœ‰å¯ç”¨çš„JSONæ•°æ®', true);
            }
        }
        
        // ç®€å•åŠ å¯†JSON
        function encryptJson() {
            const cachedData = localStorage.getItem('tvbox_json');
            
            if (cachedData) {
                try {
                    // ç®€å•åŠ å¯†ï¼šBase64ç¼–ç 
                    const encoded = btoa(encodeURIComponent(cachedData));
                    outputContent.textContent = encoded;
                    showNotification('JSONå·²åŠ å¯†ï¼ˆBase64ï¼‰ï¼');
                } catch (e) {
                    showNotification('åŠ å¯†å¤±è´¥: ' + e.message, true);
                }
            } else {
                showNotification('æ²¡æœ‰å¯ç”¨çš„JSONæ•°æ®', true);
            }
        }
        
        // æ¸…ç©ºæ‰€æœ‰
        function clearAll() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                localStorage.removeItem('tvbox_json');
                
                // é‡ç½®æ‰€æœ‰è¾“å…¥æ¡†
                document.getElementById('spider').value = '';
                document.getElementById('wallpaper').value = '';
                document.getElementById('logo').value = '';
                document.getElementById('warningText').value = '';
                
                // æ¸…ç©ºæ‰€æœ‰æ¨¡å—
                document.getElementById('sites-container').innerHTML = '';
                document.getElementById('lives-container').innerHTML = '';
                document.getElementById('parses-container').innerHTML = '';
                
                // æ¸…ç©ºè‡ªå®šä¹‰è®¾ç½®
                document.getElementById('custom-json').value = '';
                
                // æ¸…ç©ºå…¶ä»–è®¾ç½®
                document.getElementById('hosts').value = '';
                document.getElementById('doh').value = '';
                document.getElementById('flags').value = '';
                
                // æ¸…ç©ºé«˜çº§è®¾ç½®
                document.getElementById('rules').value = '';
                document.getElementById('ijk').value = '';
                document.getElementById('proxy').value = '';
                document.getElementById('ads').value = '';
                
                // æ¸…ç©ºç²˜è´´æ¡†
                document.getElementById('json-paste').value = '';
                
                // é‡æ–°åˆå§‹åŒ–
                addSiteGroup();
                addLiveGroup();
                addParseGroup();
                
                // æ¸…ç©ºè¾“å‡ºåŒºåŸŸ
                outputContent.textContent = 'æ ¼å¼åŒ–æˆ–åŠ å¯†åçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...';
                
                showNotification('æ‰€æœ‰æ•°æ®å·²æ¸…ç©ºï¼');
            }
        }
        
        // å¤åˆ¶è¾“å‡º
        function copyOutput() {
            const text = outputContent.textContent;
            if (text && text !== 'æ ¼å¼åŒ–æˆ–åŠ å¯†åçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...') {
                navigator.clipboard.writeText(text)
                    .then(() => showNotification('è¾“å‡ºå†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼'))
                    .catch(err => showNotification('å¤åˆ¶å¤±è´¥: ' + err, true));
            } else {
                showNotification('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹', true);
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, isError = false) {
            notification.textContent = message;
            notification.className = 'notification';
            
            if (isError) {
                notification.classList.add('error');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
