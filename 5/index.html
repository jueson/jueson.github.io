<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TVBoxæ¥å£ç¼–è¾‘å™¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --gray: #95a5a6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }
        
        .subtitle {
            color: var(--gray);
            font-size: 1.1rem;
        }
        
        .main-content {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-section {
            flex: 1;
            background: rgba(44, 62, 80, 0.7);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .output-section {
            flex: 1;
            background: rgba(44, 62, 80, 0.7);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section-title i {
            color: var(--primary);
            font-size: 1.5rem;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        textarea {
            width: 100%;
            height: 300px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            padding: 15px;
            color: white;
            font-family: monospace;
            resize: vertical;
        }
        
        .editor-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .editor-title {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .editor-controls {
            display: flex;
            gap: 10px;
        }
        
        .editor-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .editor-table th {
            background: rgba(52, 152, 219, 0.3);
            padding: 10px;
            text-align: left;
        }
        
        .editor-table td {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .editor-table tr:nth-child(even) {
            background: rgba(0, 0, 0, 0.2);
        }
        
        .editor-table input, .editor-table select {
            width: 100%;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            color: white;
        }
        
        .action-cell {
            display: flex;
            gap: 5px;
        }
        
        .action-btn {
            padding: 5px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .footer {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            background: var(--success);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translateX(200%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .json-key {
            color: #3498db;
        }
        
        .json-string {
            color: #2ecc71;
        }
        
        .json-number {
            color: #f39c12;
        }
        
        .json-boolean {
            color: #9b59b6;
        }
        
        .json-null {
            color: #7f8c8d;
        }
        
        .json-punctuation {
            color: #ecf0f1;
        }
        
        @media (max-width: 900px) {
            .main-content {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-tv"></i> TVBoxæ¥å£ç¼–è¾‘å™¨</h1>
            <p class="subtitle">ç¼–è¾‘ã€ç®¡ç†å’Œç”ŸæˆTVBoxé…ç½®æ–‡ä»¶</p>
        </header>
        
        <div class="main-content">
            <div class="input-section">
                <div class="section-title">
                    <i class="fas fa-edit"></i>
                    <h2>è¾“å…¥é…ç½®</h2>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" id="pasteBtn">
                        <i class="fas fa-paste"></i> ä»å‰ªè´´æ¿ç²˜è´´
                    </button>
                    <button class="btn btn-primary" id="fileBtn">
                        <i class="fas fa-file-upload"></i> ä¸Šä¼ JSONæ–‡ä»¶
                    </button>
                    <button class="btn btn-success" id="loadExampleBtn">
                        <i class="fas fa-lightbulb"></i> åŠ è½½ç¤ºä¾‹
                    </button>
                    <button class="btn btn-danger" id="clearBtn">
                        <i class="fas fa-trash"></i> æ¸…ç©º
                    </button>
                </div>
                
                <textarea id="jsonInput" placeholder='åœ¨æ­¤ç²˜è´´TVBox JSONé…ç½®æˆ–ä¸Šä¼ æ–‡ä»¶...'></textarea>
                
                <div class="editor-container">
                    <div class="editor-header">
                        <div class="editor-title">ç«™ç‚¹ç®¡ç†</div>
                        <div class="editor-controls">
                            <button class="btn btn-success" id="addSiteBtn">
                                <i class="fas fa-plus"></i> æ·»åŠ ç«™ç‚¹
                            </button>
                        </div>
                    </div>
                    
                    <table class="editor-table">
                        <thead>
                            <tr>
                                <th>åç§°</th>
                                <th>KEY</th>
                                <th>API</th>
                                <th>ç±»å‹</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="sitesTable">
                            <!-- ç«™ç‚¹æ•°æ®å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="output-section">
                <div class="section-title">
                    <i class="fas fa-code"></i>
                    <h2>è¾“å‡ºé…ç½®</h2>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" id="generateBtn">
                        <i class="fas fa-cogs"></i> ç”Ÿæˆé…ç½®
                    </button>
                    <button class="btn btn-primary" id="copyBtn">
                        <i class="fas fa-copy"></i> å¤åˆ¶å…¨éƒ¨
                    </button>
                    <button class="btn btn-warning" id="downloadBtn">
                        <i class="fas fa-download"></i> ä¸‹è½½æ–‡ä»¶
                    </button>
                </div>
                
                <div id="jsonOutput"></div>
            </div>
        </div>
        
        <div class="footer">
            <button class="btn btn-primary">
                <i class="fas fa-save"></i> ä¿å­˜æ›´æ”¹
            </button>
            <button class="btn btn-warning">
                <i class="fas fa-redo"></i> é‡ç½®æ›´æ”¹
            </button>
            <button class="btn btn-danger">
                <i class="fas fa-times"></i> å–æ¶ˆç¼–è¾‘
            </button>
        </div>
    </div>
    
    <div class="notification" id="notification">æ“ä½œæˆåŠŸï¼</div>
    
    <input type="file" id="fileInput" accept=".json" style="display: none;">
    
    <script>
        // ç¤ºä¾‹JSONæ•°æ®
        const exampleJson = {
            "spider": "https://gh-proxy.com/raw.githubusercontent.com/jueson/tvbox/refs/heads/main/OK/lib/ok1.jpg;md5;83e2ccc1e3c050154d8390b60f1a2ae2",
            "wallpaper": "http://127.0.0.1:9978/proxy?do=wall",
            "logo": "https://storage.7x24cc.com/storage-server/presigned/ss1/a6-online-fileupload/newMediaImage/ACB34B_773_photo_2022-09-14_00-00-57_20251204145106336newMediaImage.jpg",
            "sites": [
                {"key": "è±†ç“£", "name": "ğŸ¤“å…¬ä¼—å·â”ƒOKæ°å…‹", "type": 3, "api": "csp_DoubanGuard", "searchable": 0, "changeable": 1},
                {"key": "é…ç½®ä¸­å¿ƒ", "name": "ğŸ‘¨â€ğŸ³â€é…ç½®â”ƒä¸­å¿ƒ", "type": 3, "api": "csp_ConfigGuard", "searchable": 0, "changeable": 0, "indexs": 0, "style": {"type": "rect", "ratio": 1.43}},
                {"key": "æœ¬åœ°æ’­æ”¾", "name": "ğŸ¼æœ¬åœ°â”ƒæ’­æ”¾", "type": 3, "api": "csp_LocalGuard", "searchable": 0, "changeable": 0, "indexs": 0, "style": {"type": "list"}, "timeout": 5}
            ],
            "parses": [
                {"name": "èšåˆ1", "type": 3, "url": "Demo"},
                {"name": "èšåˆ0", "type": 3, "url": "Web"},
                {"name": "ikun", "type": 0, "url": "https://jx.hls.one/?url="}
            ]
        };
        
        // DOMå…ƒç´ 
        const jsonInput = document.getElementById('jsonInput');
        const jsonOutput = document.getElementById('jsonOutput');
        const pasteBtn = document.getElementById('pasteBtn');
        const fileBtn = document.getElementById('fileBtn');
        const fileInput = document.getElementById('fileInput');
        const loadExampleBtn = document.getElementById('loadExampleBtn');
        const clearBtn = document.getElementById('clearBtn');
        const generateBtn = document.getElementById('generateBtn');
        const copyBtn = document.getElementById('copyBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const addSiteBtn = document.getElementById('addSiteBtn');
        const sitesTable = document.getElementById('sitesTable');
        const notification = document.getElementById('notification');
        
        // åˆå§‹åŒ–
        function init() {
            // äº‹ä»¶ç›‘å¬
            pasteBtn.addEventListener('click', handlePaste);
            fileBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileUpload);
            loadExampleBtn.addEventListener('click', loadExample);
            clearBtn.addEventListener('click', clearAll);
            generateBtn.addEventListener('click', generateOutput);
            copyBtn.addEventListener('click', copyToClipboard);
            downloadBtn.addEventListener('click', downloadJson);
            addSiteBtn.addEventListener('click', addNewSite);
            
            // åŠ è½½ç¤ºä¾‹æ•°æ®
            loadExample();
        }
        
        // å¤„ç†ç²˜è´´
        async function handlePaste() {
            try {
                const text = await navigator.clipboard.readText();
                jsonInput.value = text;
                showNotification('å·²ä»å‰ªè´´æ¿ç²˜è´´å†…å®¹');
            } catch (err) {
                showNotification('æ— æ³•è®¿é—®å‰ªè´´æ¿ï¼Œè¯·æ‰‹åŠ¨ç²˜è´´', 'error');
            }
        }
        
        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                jsonInput.value = e.target.result;
                showNotification(`å·²åŠ è½½æ–‡ä»¶: ${file.name}`);
            };
            reader.readAsText(file);
            
            // é‡ç½®inputä»¥å…è®¸å†æ¬¡é€‰æ‹©åŒä¸€æ–‡ä»¶
            event.target.value = '';
        }
        
        // åŠ è½½ç¤ºä¾‹
        function loadExample() {
            jsonInput.value = JSON.stringify(exampleJson, null, 2);
            parseSites();
            showNotification('å·²åŠ è½½ç¤ºä¾‹é…ç½®');
        }
        
        // æ¸…ç©ºæ‰€æœ‰
        function clearAll() {
            jsonInput.value = '';
            jsonOutput.innerHTML = '';
            sitesTable.innerHTML = '';
            showNotification('å·²æ¸…ç©ºæ‰€æœ‰å†…å®¹');
        }
        
        // è§£æç«™ç‚¹æ•°æ®
        function parseSites() {
            try {
                const data = JSON.parse(jsonInput.value);
                if (data.sites && Array.isArray(data.sites)) {
                    renderSitesTable(data.sites);
                }
            } catch (e) {
                console.error('è§£æJSONå¤±è´¥:', e);
            }
        }
        
        // æ¸²æŸ“ç«™ç‚¹è¡¨æ ¼
        function renderSitesTable(sites) {
            sitesTable.innerHTML = '';
            
            sites.forEach((site, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${site.name || ''}</td>
                    <td>${site.key || ''}</td>
                    <td>${site.api || ''}</td>
                    <td>${site.type || ''}</td>
                    <td class="action-cell">
                        <button class="action-btn btn-primary" onclick="editSite(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn btn-danger" onclick="deleteSite(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                sitesTable.appendChild(row);
            });
        }
        
        // æ·»åŠ æ–°ç«™ç‚¹
        function addNewSite() {
            const newSite = {
                key: `æ–°ç«™ç‚¹${sitesTable.children.length + 1}`,
                name: "æ–°ç«™ç‚¹",
                type: 3,
                api: "csp_NewGuard",
                searchable: 1,
                changeable: 1
            };
            
            try {
                const data = JSON.parse(jsonInput.value);
                if (!data.sites) data.sites = [];
                data.sites.push(newSite);
                jsonInput.value = JSON.stringify(data, null, 2);
                renderSitesTable(data.sites);
                showNotification('å·²æ·»åŠ æ–°ç«™ç‚¹');
            } catch (e) {
                showNotification('æ·»åŠ ç«™ç‚¹å¤±è´¥ï¼Œè¯·æ£€æŸ¥JSONæ ¼å¼', 'error');
            }
        }
        
        // ç¼–è¾‘ç«™ç‚¹
        function editSite(index) {
            showNotification(`ç¼–è¾‘ç«™ç‚¹ ${index + 1}ï¼ˆåŠŸèƒ½æ¼”ç¤ºï¼‰`);
        }
        
        // åˆ é™¤ç«™ç‚¹
        function deleteSite(index) {
            try {
                const data = JSON.parse(jsonInput.value);
                if (data.sites && data.sites[index]) {
                    data.sites.splice(index, 1);
                    jsonInput.value = JSON.stringify(data, null, 2);
                    renderSitesTable(data.sites);
                    showNotification('å·²åˆ é™¤ç«™ç‚¹');
                }
            } catch (e) {
                showNotification('åˆ é™¤ç«™ç‚¹å¤±è´¥', 'error');
            }
        }
        
        // ç”Ÿæˆè¾“å‡º
        function generateOutput() {
            try {
                const jsonData = JSON.parse(jsonInput.value);
                jsonOutput.innerHTML = syntaxHighlight(JSON.stringify(jsonData, null, 2));
                showNotification('é…ç½®å·²ç”Ÿæˆ');
            } catch (e) {
                jsonOutput.innerHTML = `<div class="error">JSONæ ¼å¼é”™è¯¯: ${e.message}</div>`;
                showNotification('JSONæ ¼å¼é”™è¯¯', 'error');
            }
        }
        
        // JSONè¯­æ³•é«˜äº®
        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard() {
            if (!jsonOutput.textContent) {
                showNotification('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶', 'error');
                return;
            }
            
            const textArea = document.createElement('textarea');
            textArea.value = JSON.parse(jsonInput.value);
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            showNotification('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        }
        
        // ä¸‹è½½JSONæ–‡ä»¶
        function downloadJson() {
            if (!jsonInput.value.trim()) {
                showNotification('æ²¡æœ‰å†…å®¹å¯ä¸‹è½½', 'error');
                return;
            }
            
            try {
                const data = JSON.parse(jsonInput.value);
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'tvbox_config.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('æ–‡ä»¶å·²ä¸‹è½½');
            } catch (e) {
                showNotification('ä¸‹è½½å¤±è´¥ï¼ŒJSONæ ¼å¼é”™è¯¯', 'error');
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = 'notification show';
            notification.style.background = type === 'error' ? 'var(--danger)' : 'var(--success)';
            
            setTimeout(() => {
                notification.className = 'notification';
            }, 3000);
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        window.onload = init;
        
        // æš´éœ²å‡½æ•°ç»™å…¨å±€ä½œç”¨åŸŸ
        window.editSite = editSite;
        window.deleteSite = deleteSite;
    </script>
</body>
</html>
